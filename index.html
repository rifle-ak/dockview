<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DockView - Container Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        :root {
            /* Background Colors */
            --bg-primary: #0a0e27;
            --bg-secondary: #151a35;
            --bg-card: #1a1f3a;
            --bg-card-hover: #1f2542;

            /* Accent Colors */
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --accent-tertiary: #a78bfa;

            /* Text Colors */
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --text-muted: #64748b;

            /* Status Colors */
            --status-success: #10b981;
            --status-success-glow: rgba(16, 185, 129, 0.4);
            --status-warning: #f59e0b;
            --status-warning-glow: rgba(245, 158, 11, 0.4);
            --status-danger: #ef4444;
            --status-danger-glow: rgba(239, 68, 68, 0.4);
            --status-info: #3b82f6;
            --status-info-glow: rgba(59, 130, 246, 0.4);

            /* Legacy aliases for backwards compatibility */
            --success: var(--status-success);
            --warning: var(--status-warning);
            --danger: var(--status-danger);
            --info: var(--status-info);
        }

        /* Light Mode Theme */
        body.light-mode {
            /* Background Colors */
            --bg-primary: #f8fafc;
            --bg-secondary: #f1f5f9;
            --bg-card: #ffffff;
            --bg-card-hover: #f8fafc;

            /* Text Colors */
            --text-primary: #0f172a;
            --text-secondary: #334155;
            --text-tertiary: #64748b;
            --text-muted: #94a3b8;
        }

        body {
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        * {
            font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, #0f1328 100%);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-weight: 400;
            line-height: 1.6;
            min-height: 100vh;
            letter-spacing: -0.011em;
        }

        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            line-height: 1.3;
            letter-spacing: -0.02em;
        }

        h1 { font-size: 2rem; font-weight: 800; }
        h2 { font-size: 1.5rem; font-weight: 700; }
        h3 { font-size: 1.125rem; font-weight: 600; }

        /* Ripple Effect */
        .ripple {
            position: relative;
            overflow: hidden;
        }

        .ripple::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .ripple:active::after {
            width: 300px;
            height: 300px;
            transition: width 0s, height 0s;
        }

        /* Smooth Scroll */
        html {
            scroll-behavior: smooth;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 9999;
            animation: fadeIn 0.2s ease-out;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(26, 31, 58, 0.98) 0%, rgba(20, 25, 50, 0.98) 100%);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 1.5rem;
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: scaleIn 0.3s ease-out;
        }

        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 2px solid rgba(99, 102, 241, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 2rem;
            overflow-y: auto;
            max-height: calc(90vh - 120px);
        }

        .modal-close {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            color: #ef4444;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: scale(1.05);
        }

        .theme-card {
            background: linear-gradient(135deg, rgba(31, 38, 73, 0.6) 0%, rgba(29, 35, 66, 0.8) 100%);
            border: 2px solid rgba(99, 102, 241, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
            text-align: left;
            cursor: pointer;
        }

        .theme-card:hover {
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2);
        }

        .favorite-star {
            background: rgba(0, 0, 0, 0.3);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .favorite-star:hover {
            background: rgba(251, 191, 36, 0.2);
            transform: scale(1.1);
        }

        .favorite-star i {
            transition: all 0.3s ease;
        }

        .favorite-star:hover i {
            transform: rotate(72deg);
        }

        .notes-button {
            background: rgba(0, 0, 0, 0.3);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .notes-button:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: scale(1.1);
        }

        .notes-button.has-note {
            background: rgba(59, 130, 246, 0.3);
        }

        .notes-button i {
            transition: all 0.3s ease;
        }

        .notes-button:hover i {
            transform: scale(1.2);
        }

        .quick-stat-card {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: rgba(31, 38, 73, 0.4);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 0.75rem;
            transition: all 0.3s ease;
        }

        .quick-stat-card:hover {
            background: rgba(31, 38, 73, 0.6);
            border-color: rgba(99, 102, 241, 0.4);
            transform: translateY(-2px);
        }

        .quick-stat-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .quick-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            line-height: 1;
            color: #e2e8f0;
        }

        .quick-stat-label {
            font-size: 0.75rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .logs-container {
            background: #0a0e1a;
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 0.75rem;
            padding: 1.5rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            color: #e2e8f0;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Glassmorphism effect */
        .glass {
            background: rgba(26, 31, 58, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Card animations */
        .container-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, rgba(31, 38, 73, 0.95) 0%, rgba(29, 35, 66, 0.98) 100%);
            border: 2px solid rgba(99, 102, 241, 0.15);
            position: relative;
            animation: fadeInUp 0.6s ease-out backwards;
            backdrop-filter: blur(20px);
            overflow: hidden;
            width: 100%;
            max-width: 320px;
            margin: 0 auto;
        }

        /* Animated gradient border for high CPU/RAM usage */
        .container-card.high-usage::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            padding: 2px;
            background: linear-gradient(135deg,
                rgba(239, 68, 68, 0.8),
                rgba(245, 158, 11, 0.8),
                rgba(239, 68, 68, 0.8));
            background-size: 200% 200%;
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            animation: gradientPulse 3s ease infinite;
            z-index: 0;
        }

        @keyframes gradientPulse {
            0%, 100% {
                background-position: 0% 50%;
                opacity: 0.6;
            }
            50% {
                background-position: 100% 50%;
                opacity: 1;
            }
        }

        .container-card:hover {
            transform: translateY(-16px) scale(1.03);
            box-shadow:
                0 32px 64px rgba(99, 102, 241, 0.4),
                0 0 80px rgba(139, 92, 246, 0.3),
                0 0 120px rgba(99, 102, 241, 0.15),
                inset 0 1px 2px rgba(255, 255, 255, 0.1);
            border-color: rgba(99, 102, 241, 0.6);
        }

        .container-card:active {
            transform: translateY(-12px) scale(1.02);
            transition: all 0.1s;
        }

        .container-card.clickable {
            cursor: pointer;
        }

        .container-card.clickable:hover::after {
            content: 'ðŸ”— Click to open';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            animation: fadeIn 0.2s ease-out;
            z-index: 5;
        }

        /* Hover Quick Actions */
        .hover-actions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 0.75rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 10;
        }

        .container-card:hover .hover-actions {
            opacity: 1;
            pointer-events: all;
        }

        .hover-action-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.9), rgba(139, 92, 246, 0.9));
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        .hover-action-btn:hover {
            transform: scale(1.15);
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            box-shadow: 0 12px 24px rgba(99, 102, 241, 0.4);
        }

        .hover-action-btn:active {
            transform: scale(1.05);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Uptime badge */
        .uptime-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.125rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .uptime-online {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
        }

        .uptime-offline {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
        }

        /* Status badges */
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-running {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }

        .status-exited, .status-stopped {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        .status-paused {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
        }

        /* Health badges */
        .health-badge {
            padding: 0.375rem 0.625rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            transition: all 0.3s ease;
            animation: pulse 3s infinite;
        }

        .health-badge:hover {
            transform: scale(1.15);
            animation: glow 1s infinite;
        }

        .health-low {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
            color: #fff;
        }

        .health-medium {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.4);
            color: #fff;
        }

        .health-high {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.4);
            color: #fff;
        }

        /* Progress bars */
        .progress-container {
            height: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 9999px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            border-radius: 9999px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2.5s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-low {
            background: linear-gradient(90deg, var(--success), #059669);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
        }
        .progress-medium {
            background: linear-gradient(90deg, var(--warning), #d97706);
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.3);
        }
        .progress-high {
            background: linear-gradient(90deg, var(--danger), #dc2626);
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
            animation: pulse 2s infinite;
        }

        /* Buttons */
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
        }

        /* App icons */
        .app-icon {
            width: 52px;
            height: 52px;
            border-radius: 12px;
            padding: 10px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15));
            border: 2px solid rgba(99, 102, 241, 0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
        }

        /* Icon glow effect */
        .app-icon::after {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: inherit;
            background: radial-gradient(circle at center, currentColor 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: -1;
            filter: blur(12px);
        }

        .container-card:hover .app-icon {
            transform: scale(1.15) rotate(8deg);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(139, 92, 246, 0.3));
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
        }

        .container-card:hover .app-icon::after {
            opacity: 0.4;
        }

        /* Search bar */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 600px;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            background: rgba(26, 31, 58, 0.6);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 1rem;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* Tab buttons */
        .tab-button {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }

        .tab-button::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .tab-button.active {
            color: var(--text-primary);
        }

        .tab-button.active::after {
            transform: scaleX(1);
        }

        /* View Toggle Buttons */
        .view-toggle-btn {
            padding: 0.5rem 0.75rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 0.875rem;
            cursor: pointer;
            border-radius: 0.375rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
        }

        .view-toggle-btn:hover {
            color: var(--text-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .view-toggle-btn.active {
            color: white;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .view-toggle-btn.active:hover {
            box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
            transform: translateY(-1px);
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid rgba(99, 102, 241, 0.1);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            background: var(--bg-card);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 0.75rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideIn 0.3s ease-out;
            z-index: 1000;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Pulse animation for running status */
        .pulse-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            50% {
                opacity: 0.8;
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
            }
            50% {
                box-shadow: 0 0 40px rgba(99, 102, 241, 0.6);
            }
        }

        /* Stats counter */
        .stat-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }

        /* Widget Cards */
        .widget-card {
            background: linear-gradient(135deg, var(--bg-card) 0%, #1d2342 100%);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .widget-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 30px rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .widget-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .widget-header i {
            font-size: 1.5rem;
        }

        .widget-header h3 {
            font-weight: 600;
            font-size: 1.125rem;
            color: var(--text-primary);
        }

        .widget-content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .widget-stat {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .widget-value {
            font-size: 1.875rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .widget-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="glass sticky top-0 z-50 shadow-xl">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <div class="app-icon">
                        <i class="fab fa-docker" style="color: #2496ED;"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                            DockView
                        </h1>
                        <p class="text-xs text-gray-400">Container Management Dashboard</p>
                    </div>
                </div>

                <div class="flex items-center gap-4">
                    <!-- Auto-refresh status indicator -->
                    <div class="text-right hidden md:block">
                        <div class="text-xs text-gray-400 uppercase tracking-wide">Auto-refresh</div>
                        <div class="flex items-center gap-2">
                            <div id="refresh-status" class="flex items-center gap-2">
                                <span class="text-sm font-semibold text-indigo-400">Every 10s</span>
                                <i id="refresh-spinner" class="fas fa-sync-alt text-indigo-400" style="font-size: 12px; opacity: 0;"></i>
                            </div>
                        </div>
                        <div id="last-updated" class="text-xs text-gray-500 mt-1">--</div>
                    </div>

                    <!-- Pause/Resume button -->
                    <button id="toggle-auto-refresh" class="px-4 py-2 rounded-xl bg-indigo-500/20 hover:bg-indigo-500/30 border border-indigo-500/40 transition-all text-sm font-semibold" onclick="toggleAutoRefresh()">
                        <i class="fas fa-pause mr-2"></i>Pause
                    </button>

                    <!-- Notification Settings button -->
                    <button id="notification-settings-btn" class="px-4 py-2 rounded-xl bg-purple-500/20 hover:bg-purple-500/30 border border-purple-500/40 transition-all text-sm font-semibold" onclick="openNotificationSettings()">
                        <i class="fas fa-bell mr-2"></i>Alerts
                    </button>

                    <!-- Dark/Light Mode Toggle -->
                    <button id="dark-mode-toggle" class="px-4 py-2 rounded-xl bg-yellow-500/20 hover:bg-yellow-500/30 border border-yellow-500/40 transition-all text-sm font-semibold" onclick="toggleDarkMode()">
                        <i id="dark-mode-icon" class="fas fa-moon mr-2"></i><span id="dark-mode-text">Dark</span>
                    </button>

                    <!-- Theme Selector button -->
                    <button id="theme-selector-btn" class="px-4 py-2 rounded-xl bg-pink-500/20 hover:bg-pink-500/30 border border-pink-500/40 transition-all text-sm font-semibold" onclick="openThemeSelector()">
                        <i class="fas fa-palette mr-2"></i>Theme
                    </button>

                    <!-- Export button -->
                    <button id="export-btn" class="px-4 py-2 rounded-xl bg-green-500/20 hover:bg-green-500/30 border border-green-500/40 transition-all text-sm font-semibold" onclick="openExportMenu()">
                        <i class="fas fa-download mr-2"></i>Export
                    </button>

                    <!-- Network Topology button -->
                    <button id="network-topology-btn" class="px-4 py-2 rounded-xl bg-cyan-500/20 hover:bg-cyan-500/30 border border-cyan-500/40 transition-all text-sm font-semibold" onclick="openNetworkTopology()">
                        <i class="fas fa-project-diagram mr-2"></i>Network
                    </button>
                    </div>
                    <div id="stats-summary" class="flex gap-3">
                        <div class="quick-stat-card">
                            <div class="quick-stat-icon bg-green-500/20">
                                <i class="fas fa-play-circle text-green-400"></i>
                            </div>
                            <div>
                                <div class="quick-stat-value" id="quick-running">0</div>
                                <div class="quick-stat-label">Running</div>
                            </div>
                        </div>
                        <div class="quick-stat-card">
                            <div class="quick-stat-icon bg-orange-500/20">
                                <i class="fas fa-microchip text-orange-400"></i>
                            </div>
                            <div>
                                <div class="quick-stat-value" id="quick-cpu">0%</div>
                                <div class="quick-stat-label">Total CPU</div>
                            </div>
                        </div>
                        <div class="quick-stat-card">
                            <div class="quick-stat-icon bg-purple-500/20">
                                <i class="fas fa-memory text-purple-400"></i>
                            </div>
                            <div>
                                <div class="quick-stat-value" id="quick-ram">0 GB</div>
                                <div class="quick-stat-label">Total RAM</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <!-- Hero Section - Speedtest Display with Gauges -->
        <div id="hero-speedtest" class="mb-12" style="display: none; animation: scaleIn 0.8s ease-out;">
            <div class="relative overflow-hidden rounded-3xl p-12 glass border-2 border-indigo-500/30 shadow-2xl">
                <!-- Animated background blobs -->
                <div class="absolute top-0 right-0 w-96 h-96 bg-gradient-to-br from-indigo-500/20 to-purple-500/20 rounded-full blur-3xl -z-10 animate-pulse" style="animation-duration: 4s;"></div>
                <div class="absolute bottom-0 left-0 w-96 h-96 bg-gradient-to-tr from-blue-500/20 to-cyan-500/20 rounded-full blur-3xl -z-10 animate-pulse" style="animation-duration: 6s;"></div>

                <div class="text-center mb-8">
                    <h2 class="text-4xl font-bold mb-2 bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                        <i class="fas fa-tachometer-alt mr-3"></i>Network Performance
                    </h2>
                    <p class="text-gray-400">Real-time internet speed metrics</p>
                    <div class="mt-2 text-xs text-gray-500">
                        <span id="hero-speedtest-server">Server: --</span>
                        <span class="mx-3">â€¢</span>
                        <span id="hero-speedtest-time">Last tested: --</span>
                    </div>
                    <button
                        id="run-speedtest-btn"
                        onclick="runSpeedtest()"
                        class="mt-4 px-6 py-2 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 rounded-lg font-semibold text-sm transition-all duration-300 transform hover:scale-105 hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100">
                        <i class="fas fa-play-circle mr-2"></i>
                        <span id="speedtest-btn-text">Run Speed Test</span>
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl mx-auto">
                    <!-- Download Gauge -->
                    <div class="text-center">
                        <div class="relative w-48 h-48 mx-auto mb-4">
                            <canvas id="gauge-download"></canvas>
                            <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                <div class="text-4xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent" id="hero-download">--</div>
                                <div class="text-xs text-gray-400 uppercase">Mbps</div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-400 uppercase tracking-wider font-semibold">
                            <i class="fas fa-download text-green-400"></i> Download
                        </div>
                    </div>

                    <!-- Upload Gauge -->
                    <div class="text-center">
                        <div class="relative w-48 h-48 mx-auto mb-4">
                            <canvas id="gauge-upload"></canvas>
                            <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                <div class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent" id="hero-upload">--</div>
                                <div class="text-xs text-gray-400 uppercase">Mbps</div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-400 uppercase tracking-wider font-semibold">
                            <i class="fas fa-upload text-blue-400"></i> Upload
                        </div>
                    </div>

                    <!-- Ping Gauge -->
                    <div class="text-center">
                        <div class="relative w-48 h-48 mx-auto mb-4">
                            <canvas id="gauge-ping"></canvas>
                            <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                <div class="text-4xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent" id="hero-ping">--</div>
                                <div class="text-xs text-gray-400 uppercase">ms</div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-400 uppercase tracking-wider font-semibold">
                            <i class="fas fa-signal text-purple-400"></i> Latency
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Summary Bar -->
        <div id="stats-summary" class="mb-8" style="animation: slideInDown 0.6s ease-out;">
            <div class="glass rounded-2xl p-6 border border-indigo-500/20">
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    <!-- Total Containers -->
                    <div class="stat-item text-center">
                        <div class="text-3xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent mb-1" id="stat-total-containers">
                            0
                        </div>
                        <div class="text-xs text-gray-400 uppercase tracking-wide">
                            <i class="fas fa-cubes"></i> Total
                        </div>
                    </div>

                    <!-- Running -->
                    <div class="stat-item text-center">
                        <div class="text-3xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent mb-1" id="stat-running">
                            0
                        </div>
                        <div class="text-xs text-gray-400 uppercase tracking-wide">
                            <i class="fas fa-play-circle"></i> Running
                        </div>
                    </div>

                    <!-- Stopped -->
                    <div class="stat-item text-center">
                        <div class="text-3xl font-bold bg-gradient-to-r from-red-400 to-pink-400 bg-clip-text text-transparent mb-1" id="stat-stopped">
                            0
                        </div>
                        <div class="text-xs text-gray-400 uppercase tracking-wide">
                            <i class="fas fa-stop-circle"></i> Stopped
                        </div>
                    </div>

                    <!-- CPU Usage -->
                    <div class="stat-item text-center">
                        <div class="text-3xl font-bold bg-gradient-to-r from-orange-400 to-red-400 bg-clip-text text-transparent mb-1" id="stat-cpu">
                            --%
                        </div>
                        <canvas id="sparkline-cpu" width="100" height="30" class="mx-auto" style="max-width: 100px; height: 30px;"></canvas>
                        <div class="text-xs text-gray-400 uppercase tracking-wide mt-1">
                            <i class="fas fa-microchip"></i> CPU
                        </div>
                    </div>

                    <!-- RAM Usage -->
                    <div class="stat-item text-center">
                        <div class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent mb-1" id="stat-ram">
                            -- GB
                        </div>
                        <canvas id="sparkline-ram" width="100" height="30" class="mx-auto" style="max-width: 100px; height: 30px;"></canvas>
                        <div class="text-xs text-gray-400 uppercase tracking-wide mt-1">
                            <i class="fas fa-memory"></i> RAM
                        </div>
                    </div>

                    <!-- Widgets Active -->
                    <div class="stat-item text-center">
                        <div class="text-3xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent mb-1" id="stat-widgets">
                            0
                        </div>
                        <div class="text-xs text-gray-400 uppercase tracking-wide">
                            <i class="fas fa-th"></i> Widgets
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Widgets Section -->
        <div id="widgets-section" class="mb-12" style="display: none;">
            <h2 class="text-2xl font-bold mb-6 bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                <i class="fas fa-chart-line"></i> Service Dashboard
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Tautulli / Plex Widget -->
                <div id="widget-tautulli" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fab fa-plex" style="color: #e5a00d;"></i>
                        <h3>Plex Library</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="tautulli-movies">0</span>
                            <span class="widget-label">Movies</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="tautulli-shows">0</span>
                            <span class="widget-label">TV Shows</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="tautulli-episodes">0</span>
                            <span class="widget-label">Episodes</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="tautulli-plays">0</span>
                            <span class="widget-label">Plays Today</span>
                        </div>
                    </div>
                </div>

                <!-- Pi-hole Widget (Enhanced with Chart) -->
                <div id="widget-pihole" class="widget-card" style="display: none; grid-column: span 2;">
                    <div class="widget-header">
                        <i class="fas fa-shield-alt" style="color: #96060c;"></i>
                        <h3>Pi-hole</h3>
                        <span class="text-xs text-gray-400 ml-auto">Last 24 Hours</span>
                    </div>
                    <div class="widget-content">
                        <div class="flex gap-4 mb-4">
                            <div class="widget-stat">
                                <span class="widget-value" id="pihole-blocked">0</span>
                                <span class="widget-label">Blocked Today</span>
                            </div>
                            <div class="widget-stat">
                                <span class="widget-value" id="pihole-percent">0%</span>
                                <span class="widget-label">Block Rate</span>
                            </div>
                            <div class="widget-stat">
                                <span class="widget-value" id="pihole-queries">0</span>
                                <span class="widget-label">Total Queries</span>
                            </div>
                        </div>
                        <!-- Chart Canvas -->
                        <div style="position: relative; height: 180px;">
                            <canvas id="pihole-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Overseerr Widget -->
                <div id="widget-overseerr" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-ticket-alt" style="color: #a55eea;"></i>
                        <h3>Requests</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="overseerr-pending">0</span>
                            <span class="widget-label">Pending</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="overseerr-total">0</span>
                            <span class="widget-label">Total Requests</span>
                        </div>
                    </div>
                </div>

                <!-- Sonarr Widget -->
                <div id="widget-sonarr" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-tv" style="color: #4ECDC4;"></i>
                        <h3>Sonarr Library</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="sonarr-shows">0</span>
                            <span class="widget-label">TV Shows</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="sonarr-episodes">0</span>
                            <span class="widget-label">Episodes</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="sonarr-monitored">0</span>
                            <span class="widget-label">Monitored</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="sonarr-queue">0</span>
                            <span class="widget-label">Downloading</span>
                        </div>
                    </div>
                </div>

                <!-- Radarr Widget -->
                <div id="widget-radarr" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-film" style="color: #ffc230;"></i>
                        <h3>Radarr Library</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="radarr-total">0</span>
                            <span class="widget-label">Total Movies</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="radarr-downloaded">0</span>
                            <span class="widget-label">Downloaded</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="radarr-monitored">0</span>
                            <span class="widget-label">Monitored</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="radarr-queue">0</span>
                            <span class="widget-label">Downloading</span>
                        </div>
                    </div>
                </div>

                <!-- Tdarr Widget -->
                <div id="widget-tdarr" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-compact-disc" style="color: #f97316;"></i>
                        <h3>Tdarr</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="tdarr-queue">0</span>
                            <span class="widget-label">In Queue</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="tdarr-processing">0</span>
                            <span class="widget-label">Processing</span>
                        </div>
                    </div>
                </div>

                <!-- Prowlarr Widget -->
                <div id="widget-prowlarr" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-search" style="color: #f59e0b;"></i>
                        <h3>Prowlarr</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="prowlarr-enabled">0</span>
                            <span class="widget-label">Enabled</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="prowlarr-total">0</span>
                            <span class="widget-label">Total Indexers</span>
                        </div>
                    </div>
                </div>

                <!-- Scrutiny Widget -->
                <div id="widget-scrutiny" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-hdd" style="color: #10b981;"></i>
                        <h3>Disk Health</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="scrutiny-devices">0</span>
                            <span class="widget-label">Devices</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="scrutiny-temp">--Â°C</span>
                            <span class="widget-label">Avg Temp</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="scrutiny-critical">0</span>
                            <span class="widget-label">Critical</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="scrutiny-status">âœ“</span>
                            <span class="widget-label">Status</span>
                        </div>
                    </div>
                </div>

                <!-- Speedtest Widget -->
                <div id="widget-speedtest" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-tachometer-alt" style="color: #3b82f6;"></i>
                        <h3>Speed Test</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="speedtest-download">0</span>
                            <span class="widget-label">Download (Mbps)</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="speedtest-upload">0</span>
                            <span class="widget-label">Upload (Mbps)</span>
                        </div>
                    </div>
                </div>

                <!-- Uptime Kuma Widget -->
                <div id="widget-uptime" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-heartbeat" style="color: #10b981;"></i>
                        <h3 id="uptime-title">Status Page</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="uptime-monitors">0</span>
                            <span class="widget-label">Monitored</span>
                        </div>
                        <div class="widget-stat" style="grid-column: 1 / -1; text-align: center;">
                            <span class="widget-value" id="uptime-names" style="font-size: 0.9rem; white-space: normal;">--</span>
                            <span class="widget-label">Services</span>
                        </div>
                    </div>
                </div>

                <!-- Portainer Widget -->
                <div id="widget-portainer" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-dharmachakra" style="color: #13bef9;"></i>
                        <h3 id="portainer-title">Portainer</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="portainer-containers">0</span>
                            <span class="widget-label">Containers</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="portainer-running">0</span>
                            <span class="widget-label">Running</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="portainer-stacks">0</span>
                            <span class="widget-label">Stacks</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="portainer-volumes">0</span>
                            <span class="widget-label">Volumes</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search and Filters -->
        <div class="mb-8">
            <div class="search-container mx-auto mb-2 relative">
                <i class="fas fa-search search-icon"></i>
                <input
                    type="text"
                    id="search-input"
                    class="search-input"
                    placeholder="ðŸ” Search containers by name, image, status, app type, or notes..."
                >
                <button id="clear-search-btn"
                        onclick="clearSearch()"
                        class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-red-400 transition-all opacity-0 pointer-events-none"
                        title="Clear search">
                    <i class="fas fa-times-circle" style="font-size: 1.25rem;"></i>
                </button>
            </div>
            <div id="search-results-info" class="text-center text-sm text-gray-400 mb-4" style="display: none;">
                Found <span id="search-results-count" class="font-bold text-indigo-400">0</span> container(s)
            </div>

            <!-- Tabs and Controls -->
            <div class="flex flex-wrap justify-between items-center gap-4 border-b border-gray-700/50 pb-4">
                <!-- Status Tabs -->
                <div class="flex justify-center flex-1">
                    <button class="tab-button active" data-tab="all">
                        <i class="fas fa-th-large"></i> All
                    </button>
                    <button class="tab-button" data-tab="running">
                        <i class="fas fa-play-circle"></i> Running
                    </button>
                    <button class="tab-button" data-tab="exited">
                        <i class="fas fa-stop-circle"></i> Stopped
                    </button>
                </div>

                <!-- View Toggle -->
                <div class="flex items-center gap-3 px-4 py-2 rounded-xl bg-gray-800/40 border border-gray-700/50">
                    <span class="text-xs text-gray-400 uppercase tracking-wide font-semibold">View:</span>
                    <div class="flex items-center gap-2 bg-gray-900/60 rounded-lg p-1">
                        <button id="grid-view-btn" class="view-toggle-btn" onclick="setViewMode('grid')" title="Grid View">
                            <i class="fas fa-th"></i>
                        </button>
                        <button id="group-view-btn" class="view-toggle-btn active" onclick="setViewMode('grouped')" title="Grouped View">
                            <i class="fas fa-layer-group"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quick Filters -->
            <div class="flex flex-wrap gap-2 mt-4">
                <button onclick="filterByHighCPU()" class="px-3 py-1.5 text-xs font-semibold rounded-lg bg-orange-500/20 text-orange-300 border border-orange-500/40 hover:bg-orange-500/30 transition-all ripple">
                    <i class="fas fa-fire mr-1.5"></i>High CPU (>75%)
                </button>
                <button onclick="filterByHighRAM()" class="px-3 py-1.5 text-xs font-semibold rounded-lg bg-purple-500/20 text-purple-300 border border-purple-500/40 hover:bg-purple-500/30 transition-all ripple">
                    <i class="fas fa-memory mr-1.5"></i>High RAM (>75%)
                </button>
                <button onclick="filterByHealth()" class="px-3 py-1.5 text-xs font-semibold rounded-lg bg-red-500/20 text-red-300 border border-red-500/40 hover:bg-red-500/30 transition-all ripple">
                    <i class="fas fa-exclamation-triangle mr-1.5"></i>Unhealthy
                </button>
                <button onclick="clearFilters()" class="px-3 py-1.5 text-xs font-semibold rounded-lg bg-gray-500/20 text-gray-300 border border-gray-500/40 hover:bg-gray-500/30 transition-all ripple">
                    <i class="fas fa-times mr-1.5"></i>Clear
                </button>
            </div>
        </div>

        <!-- Bulk Actions Toolbar (hidden by default) -->
        <div id="bulk-actions-toolbar" class="mb-6" style="display: none;">
            <div class="glass rounded-2xl p-4 border-2 border-indigo-500/30 shadow-xl">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <div class="flex items-center gap-3">
                        <div class="px-3 py-1.5 bg-indigo-500/20 rounded-lg border border-indigo-500/40">
                            <span class="text-sm font-semibold text-indigo-300">
                                <i class="fas fa-check-square mr-2"></i>
                                <span id="selected-count">0</span> selected
                            </span>
                        </div>
                        <button onclick="selectAllContainers()" class="px-3 py-1.5 text-xs font-semibold rounded-lg bg-gray-600/20 text-gray-300 border border-gray-600/40 hover:bg-gray-600/30 transition-all ripple">
                            <i class="fas fa-check-double mr-1.5"></i>Select All
                        </button>
                        <button onclick="deselectAllContainers()" class="px-3 py-1.5 text-xs font-semibold rounded-lg bg-gray-600/20 text-gray-300 border border-gray-600/40 hover:bg-gray-600/30 transition-all ripple">
                            <i class="fas fa-times mr-1.5"></i>Clear
                        </button>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="bulkStartContainers()" class="px-4 py-2 text-sm font-semibold rounded-lg bg-green-500/20 text-green-300 border border-green-500/40 hover:bg-green-500/30 transition-all ripple">
                            <i class="fas fa-play mr-2"></i>Start
                        </button>
                        <button onclick="bulkStopContainers()" class="px-4 py-2 text-sm font-semibold rounded-lg bg-red-500/20 text-red-300 border border-red-500/40 hover:bg-red-500/30 transition-all ripple">
                            <i class="fas fa-stop mr-2"></i>Stop
                        </button>
                        <button onclick="bulkRestartContainers()" class="px-4 py-2 text-sm font-semibold rounded-lg bg-orange-500/20 text-orange-300 border border-orange-500/40 hover:bg-orange-500/30 transition-all ripple">
                            <i class="fas fa-redo mr-2"></i>Restart
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top 10 Resource Hogs -->
        <div id="resource-hogs" class="mb-12" style="display: none;">
            <div class="glass rounded-3xl p-8 border-2 border-indigo-500/20 shadow-2xl">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold bg-gradient-to-r from-orange-400 to-red-400 bg-clip-text text-transparent">
                        <i class="fas fa-chart-bar mr-3"></i>Top Resource Consumers
                    </h2>
                    <button id="toggle-resource-hogs" class="px-4 py-2 rounded-xl bg-indigo-500/20 hover:bg-indigo-500/30 border border-indigo-500/40 transition-all" onclick="toggleResourceHogs()">
                        <i class="fas fa-chevron-up"></i> Collapse
                    </button>
                </div>

                <div id="resource-hogs-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Top 10 CPU -->
                        <div>
                            <h3 class="text-lg font-semibold mb-4 text-orange-400">
                                <i class="fas fa-microchip mr-2"></i>Top 10 by CPU Usage
                            </h3>
                            <div id="cpu-hogs" class="space-y-3"></div>
                        </div>

                        <!-- Top 10 RAM -->
                        <div>
                            <h3 class="text-lg font-semibold mb-4 text-purple-400">
                                <i class="fas fa-memory mr-2"></i>Top 10 by RAM Usage
                            </h3>
                            <div id="ram-hogs" class="space-y-3"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading" class="flex justify-center items-center py-20">
            <div class="spinner"></div>
            <div class="ml-4 text-gray-400">Loading containers...</div>
        </div>

        <!-- Container Grid -->
        <div id="container-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-7 gap-4" style="display: none;">
            <!-- Cards will be injected here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="text-center py-20" style="display: none;">
            <div class="text-6xl mb-4">ðŸ³</div>
            <h2 class="text-2xl font-bold mb-2">No containers found</h2>
            <p class="text-gray-400">No containers match your search criteria</p>
        </div>
    </main>

    <script>
        // Service URL mappings for clickable cards
        const SERVICE_URLS = {
            plex: 'https://app.plex.tv',
            tautulli: '/tautulli',
            overseerr: '/overseerr',
            sonarr: '/sonarr',
            radarr: '/radarr',
            prowlarr: '/prowlarr',
            lidarr: '/lidarr',
            tdarr: '/tdarr',
            jellyfin: '/jellyfin',
            portainer: '/portainer',
            grafana: '/grafana',
            pihole: '/admin',
            nextcloud: '/nextcloud',
            photoprism: '/photoprism',
            immich: '/immich',
            homepage: '/',
            heimdall: '/',
            scrutiny: '/scrutiny',
            uptime: '/uptime',
            'uptime-kuma': '/uptime',
            speedtest: '/speedtest',
            'speedtest-tracker': '/speedtest',
        };

        // Icon mappings
        const APP_ICONS = {
            plex: { icon: 'fab fa-plex', color: '#e5a00d' },
            jellyfin: { icon: 'fas fa-film', color: '#00a4dc' },
            emby: { icon: 'fas fa-video', color: '#52b54b' },
            sonarr: { icon: 'fas fa-tv', color: '#4ECDC4' },
            radarr: { icon: 'fas fa-film', color: '#ffc230' },
            lidarr: { icon: 'fas fa-music', color: '#159588' },
            prowlarr: { icon: 'fas fa-search', color: '#f59e0b' },
            overseerr: { icon: 'fas fa-ticket-alt', color: '#a55eea' },
            tdarr: { icon: 'fas fa-compact-disc', color: '#f97316' },
            traefik: { icon: 'fas fa-route', color: '#24a1c1' },
            portainer: { icon: 'fas fa-dharmachakra', color: '#13bef9' },
            nginx: { icon: 'fas fa-server', color: '#009639' },
            postgresql: { icon: 'fas fa-database', color: '#336791' },
            postgres: { icon: 'fas fa-database', color: '#336791' },
            mysql: { icon: 'fas fa-database', color: '#4479a1' },
            mariadb: { icon: 'fas fa-database', color: '#c0765a' },
            redis: { icon: 'fas fa-database', color: '#dc382d' },
            mongodb: { icon: 'fas fa-leaf', color: '#47a248' },
            transmission: { icon: 'fas fa-download', color: '#e74c3c' },
            qbittorrent: { icon: 'fas fa-download', color: '#3498db' },
            sabnzbd: { icon: 'fas fa-download', color: '#ffc107' },
            nzbget: { icon: 'fas fa-download', color: '#9b59b6' },
            jackett: { icon: 'fas fa-search', color: '#34495e' },
            homepage: { icon: 'fas fa-home', color: '#6366f1' },
            heimdall: { icon: 'fas fa-home', color: '#e67e22' },
            organizr: { icon: 'fas fa-th', color: '#1abc9c' },
            grafana: { icon: 'fas fa-chart-line', color: '#f46800' },
            prometheus: { icon: 'fas fa-fire', color: '#e6522c' },
            netdata: { icon: 'fas fa-chart-area', color: '#00ab44' },
            pihole: { icon: 'fas fa-shield-alt', color: '#96060c' },
            adguard: { icon: 'fas fa-shield-alt', color: '#66b574' },
            nextcloud: { icon: 'fas fa-cloud', color: '#0082c9' },
            photoprism: { icon: 'fas fa-camera', color: '#00a0df' },
            immich: { icon: 'fas fa-images', color: '#4250af' },
            vaultwarden: { icon: 'fas fa-lock', color: '#175ddc' },
            wireguard: { icon: 'fas fa-network-wired', color: '#88171a' },
            openvpn: { icon: 'fas fa-shield-alt', color: '#ea7e20' },
            docker: { icon: 'fab fa-docker', color: '#2496ED' }
        };

        // Category definitions for grouping containers
        const CATEGORIES = {
            media: {
                name: 'Media',
                icon: 'fas fa-film',
                color: '#a55eea',
                apps: ['plex', 'jellyfin', 'emby', 'sonarr', 'radarr', 'lidarr', 'overseerr', 'tdarr', 'tautulli']
            },
            downloads: {
                name: 'Downloads',
                icon: 'fas fa-download',
                color: '#3498db',
                apps: ['transmission', 'qbittorrent', 'sabnzbd', 'nzbget', 'jackett', 'prowlarr']
            },
            monitoring: {
                name: 'Monitoring',
                icon: 'fas fa-chart-line',
                color: '#f46800',
                apps: ['grafana', 'prometheus', 'netdata', 'scrutiny', 'uptime-kuma', 'uptime', 'speedtest', 'speedtest-tracker']
            },
            network: {
                name: 'Network & Security',
                icon: 'fas fa-shield-alt',
                color: '#96060c',
                apps: ['pihole', 'adguard', 'traefik', 'nginx', 'wireguard', 'openvpn', 'vaultwarden', 'authelia']
            },
            cloud: {
                name: 'Cloud & Storage',
                icon: 'fas fa-cloud',
                color: '#0082c9',
                apps: ['nextcloud', 'photoprism', 'immich']
            },
            databases: {
                name: 'Databases',
                icon: 'fas fa-database',
                color: '#336791',
                apps: ['postgresql', 'postgres', 'mysql', 'mariadb', 'redis', 'mongodb']
            },
            management: {
                name: 'Management',
                icon: 'fas fa-dharmachakra',
                color: '#13bef9',
                apps: ['portainer', 'homepage', 'heimdall', 'organizr']
            }
        };

        // Helper function to get category for an app
        function getCategoryForApp(appType) {
            for (const [categoryKey, category] of Object.entries(CATEGORIES)) {
                if (category.apps.includes(appType)) {
                    return categoryKey;
                }
            }
            return 'other';
        }

        let allContainers = [];
        let currentFilter = 'all';
        let searchTerm = '';
        // Load saved view mode from localStorage, default to grouped
        let groupByCategory = localStorage.getItem('dockview-viewmode') === 'grid' ? false : true;

        // DOM elements
        const containerGrid = document.getElementById('container-grid');
        const loading = document.getElementById('loading');
        const emptyState = document.getElementById('empty-state');
        const searchInput = document.getElementById('search-input');
        const tabButtons = document.querySelectorAll('.tab-button');
        const statsummary = document.getElementById('stats-summary');

        // Event listeners
        searchInput.addEventListener('input', (e) => {
            searchTerm = e.target.value.toLowerCase();

            // Show/hide clear button
            const clearBtn = document.getElementById('clear-search-btn');
            if (searchTerm) {
                clearBtn.style.opacity = '1';
                clearBtn.style.pointerEvents = 'auto';
            } else {
                clearBtn.style.opacity = '0';
                clearBtn.style.pointerEvents = 'none';
            }

            filterAndRenderContainers();
        });

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                currentFilter = button.dataset.tab;
                filterAndRenderContainers();
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Don't trigger if user is typing in an input field
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                // Allow Esc to clear search
                if (e.key === 'Escape') {
                    searchInput.value = '';
                    searchTerm = '';
                    filterAndRenderContainers();
                    searchInput.blur();
                }
                return;
            }

            // / or Ctrl+K to focus search
            if (e.key === '/' || (e.ctrlKey && e.key === 'k')) {
                e.preventDefault();
                searchInput.focus();
                showToast('ðŸ” Search focused', 'info');
            }

            // G for grid view
            if (e.key === 'g' || e.key === 'G') {
                e.preventDefault();
                setViewMode('grid');
            }

            // C for category/grouped view
            if (e.key === 'c' || e.key === 'C') {
                e.preventDefault();
                setViewMode('grouped');
            }

            // R for refresh
            if (e.key === 'r' || e.key === 'R') {
                e.preventDefault();
                fetchContainers();
                showToast('ðŸ”„ Refreshing containers...', 'info');
            }

            // ? for help
            if (e.key === '?') {
                e.preventDefault();
                showKeyboardShortcutsHelp();
            }
        });

        // Fetch containers
        async function fetchContainers() {
            try {
                const startTime = performance.now();
                console.log('ðŸ”„ Fetching containers...');

                const response = await fetch('/containers');
                allContainers = await response.json();

                const elapsed = ((performance.now() - startTime) / 1000).toFixed(2);
                console.log(`âœ“ Fetched ${allContainers.length} containers in ${elapsed}s`);

                // Check for container alerts/notifications
                checkContainerAlerts(allContainers);

                // Record stats for history charts
                recordStats(allContainers);

                updateStats();
                filterAndRenderContainers();
            } catch (error) {
                console.error('âŒ Error fetching containers:', error);
                showToast('Failed to fetch containers', 'error');
            }
        }

        // Update stats summary
        function updateStats() {
            const total = allContainers.length;
            const running = allContainers.filter(c => c.status === 'running').length;
            const stopped = allContainers.filter(c => c.status !== 'running').length;

            // Calculate aggregate CPU and RAM for running containers
            let totalCpu = 0;
            let totalRam = 0;
            const runningContainers = allContainers.filter(c => c.status === 'running');

            runningContainers.forEach(container => {
                totalCpu += container.cpu || 0;
                // Convert memory from string like "150.2 MB / 4.0 GB" to GB
                if (container.memory_text && container.memory_text !== 'N/A') {
                    const memStr = container.memory_text.split('/')[0].trim(); // Get just the used portion
                    const memMatch = memStr.match(/([\d.]+)\s*(B|KB|MB|GB)/);
                    if (memMatch) {
                        const value = parseFloat(memMatch[1]);
                        const unit = memMatch[2];
                        // Convert to GB
                        if (unit === 'GB') totalRam += value;
                        else if (unit === 'MB') totalRam += value / 1024;
                        else if (unit === 'KB') totalRam += value / 1024 / 1024;
                        else if (unit === 'B') totalRam += value / 1024 / 1024 / 1024;
                    }
                }
            });

            // Update the stats summary bar with animations
            animateNumber(document.getElementById('stat-total-containers'), 0, total, 1200);
            animateNumber(document.getElementById('stat-running'), 0, running, 1000);
            animateNumber(document.getElementById('stat-stopped'), 0, stopped, 1000);
            animateNumber(document.getElementById('stat-cpu'), 0, totalCpu, 1400, '%');
            animateNumber(document.getElementById('stat-ram'), 0, totalRam, 1400, ' GB');

            // Generate sparkline trend data (24 data points for last 24 hours)
            // In production, this would come from time-series database
            const cpuTrend = [];
            const ramTrend = [];
            const baselineCpu = totalCpu;
            const baselineRam = totalRam;

            for (let i = 0; i < 24; i++) {
                // Create realistic-looking trend data with variance
                const hourOffset = (23 - i) / 24;  // Recent hours have more weight
                const variance = 0.7 + (Math.random() * 0.6);  // 70-130% variance

                // CPU tends to be higher during work hours (8am-6pm)
                const hour = (new Date().getHours() - i + 24) % 24;
                const workHourMultiplier = (hour >= 8 && hour <= 18) ? 1.2 : 0.8;

                cpuTrend.push(baselineCpu * variance * workHourMultiplier * (1 - hourOffset * 0.3));
                ramTrend.push(baselineRam * variance * (1 - hourOffset * 0.15));
            }

            // Create sparklines with gradients
            sparklineCpu = createSparkline('sparkline-cpu', cpuTrend, '#fb923c', 'rgba(251, 146, 60, ');
            sparklineRam = createSparkline('sparkline-ram', ramTrend, '#c084fc', 'rgba(192, 132, 252, ');

            // Update quick stats cards
            document.getElementById('quick-running').textContent = running;
            document.getElementById('quick-cpu').textContent = totalCpu.toFixed(1) + '%';
            document.getElementById('quick-ram').textContent = totalRam.toFixed(1) + ' GB';

            console.log(`ðŸ“Š Stats: ${total} total, ${running} running, ${stopped} stopped, CPU: ${totalCpu.toFixed(1)}%, RAM: ${totalRam.toFixed(1)} GB`);
        }

        // Filter and render containers
        function filterAndRenderContainers() {
            let filtered = allContainers;

            // Apply status filter
            if (currentFilter !== 'all') {
                filtered = filtered.filter(c => c.status === currentFilter);
            }

            // Apply enhanced search filter
            if (searchTerm) {
                filtered = filtered.filter(c => {
                    const matchName = c.name.toLowerCase().includes(searchTerm);
                    const matchImage = c.image.toLowerCase().includes(searchTerm);
                    const matchStatus = c.status.toLowerCase().includes(searchTerm);
                    const matchAppType = c.appType && c.appType.toLowerCase().includes(searchTerm);
                    const matchNotes = containerNotes[c.id] && containerNotes[c.id].toLowerCase().includes(searchTerm);

                    return matchName || matchImage || matchStatus || matchAppType || matchNotes;
                });
            }

            // Apply quick filters
            if (activeFilter === 'cpu') {
                filtered = filtered.filter(c => c.cpu > 75);
            } else if (activeFilter === 'ram') {
                filtered = filtered.filter(c => c.memory > 75);
            } else if (activeFilter === 'unhealthy') {
                filtered = filtered.filter(c => c.cpu > 75 || c.memory > 75 || c.status !== 'running');
            }

            // Update search results info
            const resultsInfo = document.getElementById('search-results-info');
            const resultsCount = document.getElementById('search-results-count');
            if (searchTerm) {
                resultsInfo.style.display = 'block';
                resultsCount.textContent = filtered.length;
            } else {
                resultsInfo.style.display = 'none';
            }

            renderContainers(filtered);
            renderResourceHogs();  // Update resource hogs chart
        }

        // Render Top 10 Resource Hogs
        function renderResourceHogs() {
            const runningContainers = allContainers.filter(c => c.status === 'running');

            if (runningContainers.length === 0) {
                document.getElementById('resource-hogs').style.display = 'none';
                return;
            }

            document.getElementById('resource-hogs').style.display = 'block';

            // Top 10 by CPU
            const topCpu = [...runningContainers]
                .sort((a, b) => b.cpu - a.cpu)
                .slice(0, 10);

            // Top 10 by RAM
            const topRam = [...runningContainers]
                .sort((a, b) => b.memory - a.memory)
                .slice(0, 10);

            // Render CPU bars
            const cpuHogsEl = document.getElementById('cpu-hogs');
            cpuHogsEl.innerHTML = topCpu.map((container, index) => {
                const appIcon = APP_ICONS[container.appType] || APP_ICONS.docker;
                const percent = container.cpu.toFixed(1);
                const colorClass = container.cpu > 75 ? 'bg-red-500' : container.cpu > 50 ? 'bg-yellow-500' : 'bg-green-500';
                const glowClass = container.cpu > 75 ? 'shadow-red-500/50' : container.cpu > 50 ? 'shadow-yellow-500/50' : 'shadow-green-500/50';

                return `
                    <div class="relative group">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-sm font-bold text-gray-400 w-6">${index + 1}.</span>
                            <div class="flex items-center gap-2 flex-1 min-w-0">
                                <i class="${appIcon.icon} text-xl" style="color: ${appIcon.color}"></i>
                                <span class="text-sm font-medium truncate">${container.name}</span>
                            </div>
                            <span class="text-sm font-bold ${container.cpu > 75 ? 'text-red-400' : container.cpu > 50 ? 'text-yellow-400' : 'text-green-400'}">${percent}%</span>
                        </div>
                        <div class="h-8 bg-gray-800/50 rounded-xl overflow-hidden border border-gray-700/50">
                            <div class="${colorClass} h-full rounded-xl transition-all duration-1000 ease-out shadow-lg ${glowClass} flex items-center justify-center"
                                 style="width: ${Math.min(container.cpu, 100)}%">
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Render RAM bars
            const ramHogsEl = document.getElementById('ram-hogs');
            ramHogsEl.innerHTML = topRam.map((container, index) => {
                const appIcon = APP_ICONS[container.appType] || APP_ICONS.docker;
                const percent = container.memory.toFixed(1);
                const colorClass = container.memory > 75 ? 'bg-red-500' : container.memory > 50 ? 'bg-yellow-500' : 'bg-green-500';
                const glowClass = container.memory > 75 ? 'shadow-red-500/50' : container.memory > 50 ? 'shadow-yellow-500/50' : 'shadow-green-500/50';

                return `
                    <div class="relative group">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-sm font-bold text-gray-400 w-6">${index + 1}.</span>
                            <div class="flex items-center gap-2 flex-1 min-w-0">
                                <i class="${appIcon.icon} text-xl" style="color: ${appIcon.color}"></i>
                                <span class="text-sm font-medium truncate">${container.name}</span>
                            </div>
                            <span class="text-sm font-bold ${container.memory > 75 ? 'text-red-400' : container.memory > 50 ? 'text-yellow-400' : 'text-green-400'}">${percent}%</span>
                        </div>
                        <div class="h-8 bg-gray-800/50 rounded-xl overflow-hidden border border-gray-700/50">
                            <div class="${colorClass} h-full rounded-xl transition-all duration-1000 ease-out shadow-lg ${glowClass}"
                                 style="width: ${Math.min(container.memory, 100)}%">
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Toggle resource hogs section
        let resourceHogsExpanded = true;
        function toggleResourceHogs() {
            resourceHogsExpanded = !resourceHogsExpanded;
            const content = document.getElementById('resource-hogs-content');
            const btn = document.getElementById('toggle-resource-hogs');

            if (resourceHogsExpanded) {
                content.style.display = 'block';
                btn.innerHTML = '<i class="fas fa-chevron-up"></i> Collapse';
            } else {
                content.style.display = 'none';
                btn.innerHTML = '<i class="fas fa-chevron-down"></i> Expand';
            }
        }

        // Render containers
        function renderContainers(containers) {
            loading.style.display = 'none';

            if (containers.length === 0) {
                containerGrid.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            containerGrid.style.display = 'grid';
            emptyState.style.display = 'none';

            // Sort containers: favorites first, then by name
            const sortedContainers = [...containers].sort((a, b) => {
                const aFav = favoriteContainers.has(a.id) ? 0 : 1;
                const bFav = favoriteContainers.has(b.id) ? 0 : 1;
                if (aFav !== bFav) return aFav - bFav;
                return a.name.localeCompare(b.name);
            });

            if (!groupByCategory) {
                // Original ungrouped rendering (with favorites sorted to top)
                containerGrid.innerHTML = renderContainerCards(sortedContainers, 0);
                return;
            }

            // Separate favorites from regular containers
            const favorites = sortedContainers.filter(c => favoriteContainers.has(c.id));
            const nonFavorites = sortedContainers.filter(c => !favoriteContainers.has(c.id));

            // Group containers by category
            const grouped = {};
            nonFavorites.forEach(container => {
                const category = getCategoryForApp(container.appType);
                if (!grouped[category]) {
                    grouped[category] = [];
                }
                grouped[category].push(container);
            });

            // Render grouped containers
            let html = '';
            let cardIndex = 0;

            // Render Favorites section first
            if (favorites.length > 0) {
                html += `
                    <div class="col-span-full mb-4" style="animation: fadeInUp 0.6s ease-out backwards;">
                        <div class="flex items-center gap-3 pb-3 border-b border-yellow-500/30">
                            <div class="text-2xl text-yellow-400">
                                <i class="fas fa-star"></i>
                            </div>
                            <h2 class="text-xl font-bold bg-gradient-to-r from-yellow-400 to-amber-400 bg-clip-text text-transparent">
                                Favorites
                            </h2>
                            <span class="text-sm text-gray-400 ml-2">(${favorites.length})</span>
                        </div>
                    </div>
                `;
                html += renderContainerCards(favorites, 0);
                cardIndex += favorites.length;
            }

            // Render defined categories
            for (const [categoryKey, categoryDef] of Object.entries(CATEGORIES)) {
                if (grouped[categoryKey] && grouped[categoryKey].length > 0) {
                    html += `
                        <div class="col-span-full mt-8 mb-4" style="animation: fadeInUp 0.6s ease-out backwards; animation-delay: ${cardIndex * 0.02}s;">
                            <div class="flex items-center gap-3 pb-3 border-b border-gray-700/50">
                                <div class="text-2xl" style="color: ${categoryDef.color}">
                                    <i class="${categoryDef.icon}"></i>
                                </div>
                                <h2 class="text-xl font-bold bg-gradient-to-r from-gray-100 to-gray-300 bg-clip-text text-transparent">
                                    ${categoryDef.name}
                                </h2>
                                <span class="text-sm text-gray-400 ml-2">(${grouped[categoryKey].length})</span>
                            </div>
                        </div>
                    `;
                    html += renderContainerCards(grouped[categoryKey], cardIndex);
                    cardIndex += grouped[categoryKey].length;
                }
            }

            // Render "Other" category if it exists
            if (grouped['other'] && grouped['other'].length > 0) {
                html += `
                    <div class="col-span-full mt-8 mb-4" style="animation: fadeInUp 0.6s ease-out backwards; animation-delay: ${cardIndex * 0.02}s;">
                        <div class="flex items-center gap-3 pb-3 border-b border-gray-700/50">
                            <div class="text-2xl" style="color: #6366f1">
                                <i class="fas fa-cubes"></i>
                            </div>
                            <h2 class="text-xl font-bold bg-gradient-to-r from-gray-100 to-gray-300 bg-clip-text text-transparent">
                                Other
                            </h2>
                            <span class="text-sm text-gray-400 ml-2">(${grouped['other'].length})</span>
                        </div>
                    </div>
                `;
                html += renderContainerCards(grouped['other'], cardIndex);
            }

            containerGrid.innerHTML = html;
        }

        // Helper function to render container cards
        function renderContainerCards(containers, startIndex) {
            return containers.map((container, index) => {
                const appIcon = APP_ICONS[container.appType] || APP_ICONS.docker;
                const cpuClass = container.cpu > 75 ? 'progress-high' : container.cpu > 50 ? 'progress-medium' : 'progress-low';
                const memClass = container.memory > 75 ? 'progress-high' : container.memory > 50 ? 'progress-medium' : 'progress-low';
                const isRunning = container.status === 'running';
                const serviceUrl = SERVICE_URLS[container.appType] || SERVICE_URLS[container.name.toLowerCase()];
                const isClickable = serviceUrl && isRunning;
                const animationDelay = ((startIndex + index) * 0.05).toFixed(2);

                // Apply high-usage class if CPU or RAM > 75%
                const isHighUsage = isRunning && (container.cpu > 75 || container.memory > 75);
                const highUsageClass = isHighUsage ? 'high-usage' : '';

                const isSelected = selectedContainers.has(container.id);
                const isFavorite = favoriteContainers.has(container.id);

                return `
                    <div class="container-card rounded-2xl p-5 shadow-xl ${isClickable ? 'clickable' : ''} ${highUsageClass}"
                         style="animation-delay: ${animationDelay}s; ${isSelected ? 'border: 2px solid rgba(99, 102, 241, 0.6);' : ''} ${isFavorite ? 'box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);' : ''}"
                         ${isClickable ? `onclick="window.open('${serviceUrl}', '_blank')"` : ''}>
                        <!-- Selection Checkbox -->
                        <div class="absolute top-3 left-3 z-10">
                            <input type="checkbox"
                                   id="select-${container.id}"
                                   ${isSelected ? 'checked' : ''}
                                   onclick="event.stopPropagation(); toggleContainerSelection('${container.id}')"
                                   class="w-5 h-5 rounded border-2 border-indigo-500/50 bg-gray-800/80 text-indigo-500 focus:ring-2 focus:ring-indigo-500/50 cursor-pointer">
                        </div>
                        <!-- Notes Button -->
                        <button class="absolute top-3 right-14 z-10 notes-button ${containerNotes[container.id] ? 'has-note' : ''}"
                                onclick="event.stopPropagation(); openNotesModal('${container.id}', '${container.name.replace(/'/g, "\\'")}')"
                                title="${containerNotes[container.id] ? 'Edit note' : 'Add note'}">
                            <i class="fas fa-sticky-note ${containerNotes[container.id] ? 'text-blue-400' : 'text-gray-600'}" style="font-size: 1.1rem;"></i>
                        </button>
                        <!-- Favorite Star -->
                        <button class="absolute top-3 right-3 z-10 favorite-star"
                                onclick="event.stopPropagation(); toggleFavorite('${container.id}')"
                                title="${isFavorite ? 'Remove from favorites' : 'Add to favorites'}">
                            <i class="fas fa-star ${isFavorite ? 'text-yellow-400' : 'text-gray-600'}" style="font-size: 1.25rem;"></i>
                        </button>
                        <!-- Header -->
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center gap-3 flex-1 min-w-0">
                                <div class="app-icon" style="color: ${appIcon.color}">
                                    <i class="${appIcon.icon}"></i>
                                </div>
                                <div class="min-w-0 flex-1">
                                    <h3 class="font-bold text-base truncate mb-0.5">${container.name}</h3>
                                    <p class="text-xs text-gray-400 truncate leading-tight">${container.image}</p>
                                </div>
                            </div>
                            <div class="flex flex-col gap-1.5 items-end">
                                <span class="status-badge status-${container.status}">
                                    ${isRunning ? '<span class="pulse-dot"></span>' : ''}
                                    ${container.status}
                                </span>
                                ${isRunning ? `
                                    <span class="health-badge health-${cpuClass}" title="System Health: CPU ${container.cpu.toFixed(1)}% â€¢ RAM ${container.memory.toFixed(1)}%">
                                        <i class="fas fa-heartbeat"></i>
                                    </span>
                                ` : ''}
                            </div>
                        </div>

                        <!-- Stats -->
                        <div class="space-y-2.5 mb-4">
                            <div>
                                <div class="flex justify-between text-xs text-gray-400 mb-1">
                                    <span><i class="fas fa-clock mr-1.5"></i>Uptime</span>
                                    <span class="font-semibold text-gray-300">${container.uptime}</span>
                                </div>
                            </div>

                            ${isRunning ? `
                                <div>
                                    <div class="flex justify-between text-xs text-gray-400 mb-1">
                                        <span><i class="fas fa-microchip mr-1.5"></i>CPU</span>
                                        <span class="font-semibold text-gray-300">${container.cpu.toFixed(1)}%</span>
                                    </div>
                                    <div class="progress-container" style="height: 6px;">
                                        <div class="progress-bar ${cpuClass}" style="width: ${Math.min(container.cpu, 100)}%"></div>
                                    </div>
                                </div>

                                <div>
                                    <div class="flex justify-between text-xs text-gray-400 mb-1">
                                        <span><i class="fas fa-memory mr-1.5"></i>Memory</span>
                                        <span class="font-semibold text-gray-300">${container.memory.toFixed(1)}%</span>
                                    </div>
                                    <div class="progress-container" style="height: 6px;">
                                        <div class="progress-bar ${memClass}" style="width: ${Math.min(container.memory, 100)}%"></div>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-0.5">${container.memory_text}</div>
                                </div>
                            ` : ''}
                        </div>

                        <!-- Quick Stats Badges -->
                        ${isRunning ? `
                            <div class="flex gap-2 mb-4">
                                <div class="flex-1 rounded-lg px-3 py-2 text-center ${cpuClass === 'progress-high' ? 'bg-red-500/15 border border-red-500/40' : cpuClass === 'progress-medium' ? 'bg-yellow-500/15 border border-yellow-500/40' : 'bg-green-500/15 border border-green-500/40'} transition-all duration-300 hover:scale-105">
                                    <div class="text-xs text-gray-400 mb-0.5"><i class="fas fa-microchip"></i></div>
                                    <div class="text-sm font-bold ${cpuClass === 'progress-high' ? 'text-red-400' : cpuClass === 'progress-medium' ? 'text-yellow-400' : 'text-green-400'}">${container.cpu.toFixed(1)}%</div>
                                </div>
                                <div class="flex-1 rounded-lg px-3 py-2 text-center ${memClass === 'progress-high' ? 'bg-red-500/15 border border-red-500/40' : memClass === 'progress-medium' ? 'bg-yellow-500/15 border border-yellow-500/40' : 'bg-green-500/15 border border-green-500/40'} transition-all duration-300 hover:scale-105">
                                    <div class="text-xs text-gray-400 mb-0.5"><i class="fas fa-memory"></i></div>
                                    <div class="text-sm font-bold ${memClass === 'progress-high' ? 'text-red-400' : memClass === 'progress-medium' ? 'text-yellow-400' : 'text-green-400'}">${container.memory.toFixed(1)}%</div>
                                </div>
                            </div>
                        ` : ''}

                        <!-- Ports -->
                        ${container.ports && container.ports.length > 0 ? `
                            <div class="mb-3">
                                <div class="text-xs text-gray-400 mb-2"><i class="fas fa-network-wired mr-1.5"></i>Ports</div>
                                <div class="flex flex-wrap gap-1.5">
                                    ${container.ports.map(port => `
                                        <span class="px-2 py-1 bg-indigo-500/20 text-indigo-300 rounded text-xs font-mono border border-indigo-500/30 hover:bg-indigo-500/30 transition-all">${port}</span>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <!-- Actions -->
                        <div class="flex gap-2 mt-4 pt-4 border-t border-gray-700/30">
                            ${isRunning ? `
                                <button onclick="event.stopPropagation(); restartContainer('${container.id}')" class="btn btn-warning flex-1 py-2 rounded-lg text-sm font-semibold hover:scale-105 transition-transform ripple">
                                    <i class="fas fa-redo mr-1.5"></i>Restart
                                </button>
                                <button onclick="event.stopPropagation(); stopContainer('${container.id}')" class="btn btn-danger flex-1 py-2 rounded-lg text-sm font-semibold hover:scale-105 transition-transform ripple">
                                    <i class="fas fa-stop mr-1.5"></i>Stop
                                </button>
                            ` : `
                                <button onclick="event.stopPropagation(); startContainer('${container.id}')" class="btn btn-success flex-1 py-2 rounded-lg text-sm font-semibold hover:scale-105 transition-transform ripple">
                                    <i class="fas fa-play mr-1.5"></i>Start
                                </button>
                            `}
                        </div>

                        <!-- Hover Quick Actions -->
                        <div class="hover-actions">
                            <button onclick="event.stopPropagation(); viewLogs('${container.id}', '${container.name}')" class="hover-action-btn" title="View Logs">
                                <i class="fas fa-file-alt"></i>
                            </button>
                            ${isRunning ? `
                                <button onclick="event.stopPropagation(); execTerminal('${container.id}', '${container.name}')" class="hover-action-btn" title="Terminal">
                                    <i class="fas fa-terminal"></i>
                                </button>
                            ` : ''}
                            <button onclick="event.stopPropagation(); showContainerInfo('${container.id}')" class="hover-action-btn" title="Container Info">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <button onclick="event.stopPropagation(); viewStatsHistory('${container.id}', '${container.name}')" class="hover-action-btn" title="Stats History">
                                <i class="fas fa-chart-line"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Toggle category grouping
        // View mode toggle
        function setViewMode(mode) {
            const gridBtn = document.getElementById('grid-view-btn');
            const groupBtn = document.getElementById('group-view-btn');

            if (mode === 'grid') {
                groupByCategory = false;
                gridBtn.classList.add('active');
                groupBtn.classList.remove('active');
                localStorage.setItem('dockview-viewmode', 'grid');
                showToast('ðŸ“± Grid view - All containers', 'info');
            } else {
                groupByCategory = true;
                gridBtn.classList.remove('active');
                groupBtn.classList.add('active');
                localStorage.setItem('dockview-viewmode', 'grouped');
                showToast('ðŸ“‚ Grouped by category', 'info');
            }

            filterAndRenderContainers();
            console.log(`View mode changed to: ${mode}, groupByCategory=${groupByCategory}`);
        }

        // Initialize view toggle buttons based on saved preference
        function initializeViewMode() {
            const gridBtn = document.getElementById('grid-view-btn');
            const groupBtn = document.getElementById('group-view-btn');

            if (groupByCategory) {
                groupBtn.classList.add('active');
                gridBtn.classList.remove('active');
            } else {
                gridBtn.classList.add('active');
                groupBtn.classList.remove('active');
            }
        }

        // Quick filter functions
        let activeFilter = null;

        function filterByHighCPU() {
            activeFilter = 'cpu';
            searchTerm = '';
            const searchInput = document.getElementById('search-input');
            if (searchInput) searchInput.value = '';
            filterAndRenderContainers();
            showToast('ðŸ”¥ Showing high CPU containers (>75%)', 'info');
        }

        function filterByHighRAM() {
            activeFilter = 'ram';
            searchTerm = '';
            const searchInput = document.getElementById('search-input');
            if (searchInput) searchInput.value = '';
            filterAndRenderContainers();
            showToast('ðŸ’¾ Showing high RAM containers (>75%)', 'info');
        }

        function filterByHealth() {
            activeFilter = 'unhealthy';
            searchTerm = '';
            const searchInput = document.getElementById('search-input');
            if (searchInput) searchInput.value = '';
            filterAndRenderContainers();
            showToast('âš ï¸ Showing unhealthy containers', 'info');
        }

        function clearFilters() {
            activeFilter = null;
            searchTerm = '';
            const searchInput = document.getElementById('search-input');
            if (searchInput) searchInput.value = '';
            filterAndRenderContainers();
            showToast('âœ“ Filters cleared', 'success');
        }

        function clearSearch() {
            searchTerm = '';
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.value = '';
                searchInput.focus();
            }

            // Hide clear button
            const clearBtn = document.getElementById('clear-search-btn');
            clearBtn.style.opacity = '0';
            clearBtn.style.pointerEvents = 'none';

            filterAndRenderContainers();
        }

        // Bulk Actions
        let selectedContainers = new Set();

        function toggleContainerSelection(id) {
            if (selectedContainers.has(id)) {
                selectedContainers.delete(id);
            } else {
                selectedContainers.add(id);
            }
            updateBulkActionsToolbar();
            filterAndRenderContainers();  // Re-render to update checkboxes and border
        }

        function updateBulkActionsToolbar() {
            const toolbar = document.getElementById('bulk-actions-toolbar');
            const countEl = document.getElementById('selected-count');
            const count = selectedContainers.size;

            countEl.textContent = count;

            if (count > 0) {
                toolbar.style.display = 'block';
            } else {
                toolbar.style.display = 'none';
            }
        }

        function selectAllContainers() {
            // Select all currently visible/filtered containers
            const filtered = getFilteredContainers();
            filtered.forEach(c => selectedContainers.add(c.id));
            updateBulkActionsToolbar();
            filterAndRenderContainers();
            showToast(`âœ“ Selected ${filtered.length} containers`, 'success');
        }

        function deselectAllContainers() {
            selectedContainers.clear();
            updateBulkActionsToolbar();
            filterAndRenderContainers();
            showToast('âœ“ Selection cleared', 'success');
        }

        function getFilteredContainers() {
            let filtered = allContainers;

            if (currentFilter !== 'all') {
                filtered = filtered.filter(c => c.status === currentFilter);
            }

            if (searchTerm) {
                filtered = filtered.filter(c => {
                    const matchName = c.name.toLowerCase().includes(searchTerm);
                    const matchImage = c.image.toLowerCase().includes(searchTerm);
                    const matchStatus = c.status.toLowerCase().includes(searchTerm);
                    const matchAppType = c.appType && c.appType.toLowerCase().includes(searchTerm);
                    const matchNotes = containerNotes[c.id] && containerNotes[c.id].toLowerCase().includes(searchTerm);

                    return matchName || matchImage || matchStatus || matchAppType || matchNotes;
                });
            }

            if (activeFilter === 'cpu') {
                filtered = filtered.filter(c => c.cpu > 75);
            } else if (activeFilter === 'ram') {
                filtered = filtered.filter(c => c.memory > 75);
            } else if (activeFilter === 'unhealthy') {
                filtered = filtered.filter(c => c.cpu > 75 || c.memory > 75 || c.status !== 'running');
            }

            return filtered;
        }

        async function bulkStartContainers() {
            const count = selectedContainers.size;
            if (count === 0) {
                showToast('No containers selected', 'warning');
                return;
            }

            showToast(`Starting ${count} containers...`, 'info');
            let succeeded = 0;
            let failed = 0;

            for (const id of selectedContainers) {
                try {
                    await fetch(`/start/${id}`, { method: 'POST' });
                    succeeded++;
                } catch (error) {
                    failed++;
                }
            }

            deselectAllContainers();
            setTimeout(fetchContainers, 1000);
            showToast(`âœ“ Started ${succeeded} containers${failed > 0 ? `, ${failed} failed` : ''}`, succeeded > 0 ? 'success' : 'error');
        }

        async function bulkStopContainers() {
            const count = selectedContainers.size;
            if (count === 0) {
                showToast('No containers selected', 'warning');
                return;
            }

            showToast(`Stopping ${count} containers...`, 'info');
            let succeeded = 0;
            let failed = 0;

            for (const id of selectedContainers) {
                try {
                    await fetch(`/stop/${id}`, { method: 'POST' });
                    succeeded++;
                } catch (error) {
                    failed++;
                }
            }

            deselectAllContainers();
            setTimeout(fetchContainers, 1000);
            showToast(`âœ“ Stopped ${succeeded} containers${failed > 0 ? `, ${failed} failed` : ''}`, succeeded > 0 ? 'success' : 'error');
        }

        async function bulkRestartContainers() {
            const count = selectedContainers.size;
            if (count === 0) {
                showToast('No containers selected', 'warning');
                return;
            }

            showToast(`Restarting ${count} containers...`, 'info');
            let succeeded = 0;
            let failed = 0;

            for (const id of selectedContainers) {
                try {
                    await fetch(`/restart/${id}`, { method: 'POST' });
                    succeeded++;
                } catch (error) {
                    failed++;
                }
            }

            deselectAllContainers();
            setTimeout(fetchContainers, 1000);
            showToast(`âœ“ Restarted ${succeeded} containers${failed > 0 ? `, ${failed} failed` : ''}`, succeeded > 0 ? 'success' : 'error');
        }

        // Favorites System
        let favoriteContainers = new Set();

        function loadFavorites() {
            const saved = localStorage.getItem('dockview-favorites');
            if (saved) {
                favoriteContainers = new Set(JSON.parse(saved));
            }
        }

        function saveFavorites() {
            localStorage.setItem('dockview-favorites', JSON.stringify([...favoriteContainers]));
        }

        function toggleFavorite(id) {
            if (favoriteContainers.has(id)) {
                favoriteContainers.delete(id);
                showToast('Removed from favorites', 'info');
            } else {
                favoriteContainers.add(id);
                showToast('â­ Added to favorites', 'success');
            }
            saveFavorites();
            filterAndRenderContainers();  // Re-render to update star and sorting
        }

        // Container Notes System
        let containerNotes = {};
        let currentNoteContainerId = null;

        function loadNotes() {
            const saved = localStorage.getItem('dockview-notes');
            if (saved) {
                containerNotes = JSON.parse(saved);
            }
        }

        function saveNotes() {
            localStorage.setItem('dockview-notes', JSON.stringify(containerNotes));
        }

        function openNotesModal(containerId, containerName) {
            currentNoteContainerId = containerId;
            document.getElementById('notes-container-name').textContent = containerName;
            document.getElementById('notes-textarea').value = containerNotes[containerId] || '';
            document.getElementById('notes-modal').style.display = 'flex';
        }

        function closeNotesModal() {
            document.getElementById('notes-modal').style.display = 'none';
            currentNoteContainerId = null;
        }

        function saveNote() {
            if (!currentNoteContainerId) return;

            const noteText = document.getElementById('notes-textarea').value.trim();

            if (noteText) {
                containerNotes[currentNoteContainerId] = noteText;
                showToast('ðŸ“ Note saved successfully', 'success');
            } else {
                delete containerNotes[currentNoteContainerId];
                showToast('Note removed', 'info');
            }

            saveNotes();
            filterAndRenderContainers();  // Re-render to update notes button
            closeNotesModal();
        }

        function deleteNote() {
            if (!currentNoteContainerId) return;

            if (containerNotes[currentNoteContainerId]) {
                delete containerNotes[currentNoteContainerId];
                saveNotes();
                showToast('Note deleted', 'info');
                filterAndRenderContainers();  // Re-render to update notes button
                closeNotesModal();
            }
        }

        // Container actions
        async function startContainer(id) {
            try {
                await fetch(`/start/${id}`, { method: 'POST' });
                showToast('Container started successfully', 'success');
                setTimeout(fetchContainers, 1000);
            } catch (error) {
                showToast('Failed to start container', 'error');
            }
        }

        async function stopContainer(id) {
            try {
                await fetch(`/stop/${id}`, { method: 'POST' });
                showToast('Container stopped successfully', 'success');
                setTimeout(fetchContainers, 1000);
            } catch (error) {
                showToast('Failed to stop container', 'error');
            }
        }

        async function restartContainer(id) {
            try {
                await fetch(`/restart/${id}`, { method: 'POST' });
                showToast('Container restarting...', 'info');
                setTimeout(fetchContainers, 2000);
            } catch (error) {
                showToast('Failed to restart container', 'error');
            }
        }

        // Quick action functions - Logs Viewer Modal
        async function viewLogs(id, name) {
            const modal = document.getElementById('logs-modal');
            const loading = document.getElementById('logs-loading');
            const content = document.getElementById('logs-content');
            const containerName = document.getElementById('logs-container-name');

            containerName.textContent = name;
            modal.classList.add('active');
            loading.style.display = 'block';
            content.style.display = 'none';

            try {
                const response = await fetch(`/logs/${id}?tail=200`);
                const data = await response.json();

                content.textContent = data.logs || 'No logs available';
                loading.style.display = 'none';
                content.style.display = 'block';
            } catch (error) {
                content.textContent = `Error loading logs: ${error.message}`;
                loading.style.display = 'none';
                content.style.display = 'block';
            }
        }

        function closeLogsModal() {
            document.getElementById('logs-modal').classList.remove('active');
        }

        function execTerminal(id, name) {
            showToast(`Terminal feature coming soon for ${name}`, 'info');
            console.log(`ðŸ’» Exec terminal for container: ${id} (${name})`);
        }

        // Container Details Modal
        async function showContainerInfo(id) {
            const modal = document.getElementById('details-modal');
            const loading = document.getElementById('details-loading');
            const content = document.getElementById('details-content');
            const containerName = document.getElementById('details-container-name');

            const container = allContainers.find(c => c.id === id);
            if (!container) return;

            containerName.textContent = container.name;
            modal.classList.add('active');
            loading.style.display = 'block';
            content.style.display = 'none';

            try {
                const response = await fetch(`/details/${id}`);
                const data = await response.json();

                const html = `
                    <div class="space-y-6">
                        <div class="glass p-4 rounded-xl">
                            <h3 class="text-lg font-bold mb-3 text-indigo-400">
                                <i class="fas fa-info-circle mr-2"></i>Basic Information
                            </h3>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div><span class="text-gray-400">ID:</span> <span class="font-mono text-xs">${data.id.substring(0, 12)}</span></div>
                                <div><span class="text-gray-400">Status:</span> <span class="font-semibold">${data.status}</span></div>
                                <div class="col-span-2"><span class="text-gray-400">Image:</span> <span class="font-mono text-xs">${data.image}</span></div>
                                <div class="col-span-2"><span class="text-gray-400">Created:</span> ${new Date(data.created).toLocaleString()}</div>
                                <div><span class="text-gray-400">Restart Policy:</span> ${data.restart_policy}</div>
                            </div>
                        </div>

                        ${data.networks && data.networks.length > 0 ? `
                        <div class="glass p-4 rounded-xl">
                            <h3 class="text-lg font-bold mb-3 text-indigo-400">
                                <i class="fas fa-network-wired mr-2"></i>Networks
                            </h3>
                            <div class="flex flex-wrap gap-2">
                                ${data.networks.map(net => `<span class="px-3 py-1 bg-indigo-500/20 text-indigo-300 rounded-lg text-sm font-mono">${net}</span>`).join('')}
                            </div>
                        </div>
                        ` : ''}

                        ${data.volumes && data.volumes.length > 0 ? `
                        <div class="glass p-4 rounded-xl">
                            <h3 class="text-lg font-bold mb-3 text-purple-400">
                                <i class="fas fa-hdd mr-2"></i>Volume Mounts
                            </h3>
                            <div class="space-y-2">
                                ${data.volumes.map(vol => `<div class="font-mono text-xs bg-gray-800/50 p-2 rounded">${vol}</div>`).join('')}
                            </div>
                        </div>
                        ` : ''}

                        ${data.env && data.env.length > 0 ? `
                        <div class="glass p-4 rounded-xl">
                            <h3 class="text-lg font-bold mb-3 text-green-400">
                                <i class="fas fa-cog mr-2"></i>Environment Variables (${data.env.length})
                            </h3>
                            <div class="space-y-1 max-h-64 overflow-y-auto">
                                ${data.env.map(e => {
                                    const parts = e.split('=');
                                    const key = parts[0];
                                    const value = parts.slice(1).join('=');
                                    return `<div class="font-mono text-xs"><span class="text-green-400">${key}</span>=<span class="text-gray-300">${value}</span></div>`;
                                }).join('')}
                            </div>
                        </div>
                        ` : ''}

                        ${data.command && data.command.length > 0 ? `
                        <div class="glass p-4 rounded-xl">
                            <h3 class="text-lg font-bold mb-3 text-yellow-400">
                                <i class="fas fa-terminal mr-2"></i>Command
                            </h3>
                            <div class="font-mono text-xs bg-gray-800/50 p-3 rounded">${data.command.join(' ')}</div>
                        </div>
                        ` : ''}
                    </div>
                `;

                content.innerHTML = html;
                loading.style.display = 'none';
                content.style.display = 'block';
            } catch (error) {
                content.innerHTML = `<p class="text-red-400">Error loading details: ${error.message}</p>`;
                loading.style.display = 'none';
                content.style.display = 'block';
            }
        }

        function closeDetailsModal() {
            document.getElementById('details-modal').classList.remove('active');
        }

        // Notification System
        let notificationPreferences = {
            enabled: false,
            notifyStopped: true,
            notifyCPU: true,
            notifyRAM: true,
            notifyRestarted: true
        };

        let previousContainerStates = new Map();  // Track previous states to detect changes
        let notificationCooldown = new Set();  // Prevent notification spam

        function loadNotificationPreferences() {
            const saved = localStorage.getItem('dockview-notifications');
            if (saved) {
                notificationPreferences = JSON.parse(saved);

                // Update UI checkboxes
                document.getElementById('notify-stopped').checked = notificationPreferences.notifyStopped;
                document.getElementById('notify-cpu').checked = notificationPreferences.notifyCPU;
                document.getElementById('notify-ram').checked = notificationPreferences.notifyRAM;
                document.getElementById('notify-restarted').checked = notificationPreferences.notifyRestarted;
            }

            // Check permission status on load
            updatePermissionStatus();

            // Add event listeners to checkboxes
            document.getElementById('notify-stopped').addEventListener('change', (e) => {
                notificationPreferences.notifyStopped = e.target.checked;
                saveNotificationPreferences();
            });
            document.getElementById('notify-cpu').addEventListener('change', (e) => {
                notificationPreferences.notifyCPU = e.target.checked;
                saveNotificationPreferences();
            });
            document.getElementById('notify-ram').addEventListener('change', (e) => {
                notificationPreferences.notifyRAM = e.target.checked;
                saveNotificationPreferences();
            });
            document.getElementById('notify-restarted').addEventListener('change', (e) => {
                notificationPreferences.notifyRestarted = e.target.checked;
                saveNotificationPreferences();
            });
        }

        function saveNotificationPreferences() {
            localStorage.setItem('dockview-notifications', JSON.stringify(notificationPreferences));
        }

        function updatePermissionStatus() {
            const statusEl = document.getElementById('permission-status');
            const btnEl = document.getElementById('request-permission-btn');

            if (!('Notification' in window)) {
                statusEl.textContent = 'Not Supported';
                statusEl.className = 'px-3 py-1 rounded-lg text-xs font-semibold bg-red-500/20 text-red-300';
                btnEl.disabled = true;
                btnEl.innerHTML = '<i class="fas fa-ban mr-2"></i>Not Supported';
                return;
            }

            if (Notification.permission === 'granted') {
                statusEl.textContent = 'Granted';
                statusEl.className = 'px-3 py-1 rounded-lg text-xs font-semibold bg-green-500/20 text-green-300';
                btnEl.disabled = true;
                btnEl.innerHTML = '<i class="fas fa-check mr-2"></i>Enabled';
                notificationPreferences.enabled = true;
                saveNotificationPreferences();
            } else if (Notification.permission === 'denied') {
                statusEl.textContent = 'Denied';
                statusEl.className = 'px-3 py-1 rounded-lg text-xs font-semibold bg-red-500/20 text-red-300';
                btnEl.disabled = true;
                btnEl.innerHTML = '<i class="fas fa-lock mr-2"></i>Blocked';
            } else {
                statusEl.textContent = 'Not Granted';
                statusEl.className = 'px-3 py-1 rounded-lg text-xs font-semibold bg-gray-500/20 text-gray-300';
                btnEl.disabled = false;
                btnEl.innerHTML = '<i class="fas fa-unlock mr-2"></i>Enable Notifications';
            }
        }

        async function requestNotificationPermission() {
            if (!('Notification' in window)) {
                showToast('Notifications not supported in this browser', 'error');
                return;
            }

            try {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    showToast('âœ“ Notifications enabled', 'success');
                    notificationPreferences.enabled = true;
                    saveNotificationPreferences();
                } else {
                    showToast('Notification permission denied', 'warning');
                }
                updatePermissionStatus();
            } catch (error) {
                showToast('Failed to request notification permission', 'error');
            }
        }

        function sendNotification(title, body, icon = 'ðŸ””') {
            if (!notificationPreferences.enabled || Notification.permission !== 'granted') {
                return;
            }

            // Check cooldown to prevent spam
            const key = `${title}-${body}`;
            if (notificationCooldown.has(key)) {
                return;
            }

            notificationCooldown.add(key);
            setTimeout(() => notificationCooldown.delete(key), 60000);  // 1 minute cooldown

            new Notification(title, {
                body: body,
                icon: '/favicon.ico',
                badge: '/favicon.ico',
                tag: key,
                requireInteraction: false
            });
        }

        function sendTestNotification() {
            if (Notification.permission !== 'granted') {
                showToast('Please enable notifications first', 'warning');
                return;
            }

            sendNotification(
                'DockView Test Notification',
                'Notifications are working! You will receive alerts based on your preferences.',
                'âœ…'
            );
            showToast('âœ“ Test notification sent', 'success');
        }

        function openNotificationSettings() {
            const modal = document.getElementById('notification-settings-modal');
            modal.classList.add('active');
            updatePermissionStatus();
        }

        function closeNotificationSettings() {
            document.getElementById('notification-settings-modal').classList.remove('active');
        }

        // Theme System
        const THEMES = {
            default: {
                name: 'Indigo Wave',
                primary: '#6366f1',
                secondary: '#8b5cf6',
                accent: '#a855f7',
                bgGradientStart: 'rgba(31, 38, 73, 0.95)',
                bgGradientEnd: 'rgba(29, 35, 66, 0.98)'
            },
            green: {
                name: 'Emerald Forest',
                primary: '#10b981',
                secondary: '#059669',
                accent: '#34d399',
                bgGradientStart: 'rgba(6, 78, 59, 0.95)',
                bgGradientEnd: 'rgba(2, 44, 34, 0.98)'
            },
            cyberpunk: {
                name: 'Neon Cyberpunk',
                primary: '#ec4899',
                secondary: '#f97316',
                accent: '#a855f7',
                bgGradientStart: 'rgba(24, 24, 27, 0.95)',
                bgGradientEnd: 'rgba(39, 39, 42, 0.98)'
            },
            ocean: {
                name: 'Deep Ocean',
                primary: '#06b6d4',
                secondary: '#0891b2',
                accent: '#22d3ee',
                bgGradientStart: 'rgba(22, 78, 99, 0.95)',
                bgGradientEnd: 'rgba(8, 51, 68, 0.98)'
            },
            sunset: {
                name: 'Warm Sunset',
                primary: '#f97316',
                secondary: '#ea580c',
                accent: '#fbbf24',
                bgGradientStart: 'rgba(124, 45, 18, 0.95)',
                bgGradientEnd: 'rgba(67, 20, 7, 0.98)'
            },
            darkpurple: {
                name: 'Dark Violet',
                primary: '#a855f7',
                secondary: '#9333ea',
                accent: '#c084fc',
                bgGradientStart: 'rgba(88, 28, 135, 0.95)',
                bgGradientEnd: 'rgba(59, 7, 100, 0.98)'
            }
        };

        let currentTheme = 'default';

        function applyTheme(themeName) {
            if (!THEMES[themeName]) {
                console.error('Theme not found:', themeName);
                return;
            }

            const theme = THEMES[themeName];
            currentTheme = themeName;

            // Update CSS variables
            document.documentElement.style.setProperty('--theme-primary', theme.primary);
            document.documentElement.style.setProperty('--theme-secondary', theme.secondary);
            document.documentElement.style.setProperty('--theme-accent', theme.accent);

            // Update all elements with indigo colors to use theme colors
            const style = document.createElement('style');
            style.id = 'theme-override';
            const existingStyle = document.getElementById('theme-override');
            if (existingStyle) {
                existingStyle.remove();
            }

            style.textContent = `
                /* Override indigo colors with theme colors */
                .bg-indigo-500\\/20 { background-color: ${hexToRgba(theme.primary, 0.2)} !important; }
                .bg-indigo-500\\/30 { background-color: ${hexToRgba(theme.primary, 0.3)} !important; }
                .hover\\:bg-indigo-500\\/30:hover { background-color: ${hexToRgba(theme.primary, 0.3)} !important; }
                .border-indigo-500\\/40 { border-color: ${hexToRgba(theme.primary, 0.4)} !important; }
                .border-indigo-500\\/50 { border-color: ${hexToRgba(theme.primary, 0.5)} !important; }
                .text-indigo-400 { color: ${theme.primary} !important; }
                .from-indigo-400 { --tw-gradient-from: ${theme.primary} !important; }
                .to-purple-400 { --tw-gradient-to: ${theme.secondary} !important; }
                .container-card { background: linear-gradient(135deg, ${theme.bgGradientStart} 0%, ${theme.bgGradientEnd} 100%) !important; }
            `;
            document.head.appendChild(style);

            // Update theme checkmarks
            Object.keys(THEMES).forEach(t => {
                const check = document.getElementById(`theme-check-${t}`);
                if (check) {
                    check.style.display = t === themeName ? 'block' : 'none';
                }
            });

            // Save to localStorage
            localStorage.setItem('dockview-theme', themeName);
            showToast(`âœ“ Theme: ${theme.name}`, 'success');
        }

        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        function openThemeSelector() {
            const modal = document.getElementById('theme-selector-modal');
            modal.classList.add('active');

            // Update checkmarks to show current theme
            Object.keys(THEMES).forEach(t => {
                const check = document.getElementById(`theme-check-${t}`);
                if (check) {
                    check.style.display = t === currentTheme ? 'block' : 'none';
                }
            });
        }

        function closeThemeSelector() {
            document.getElementById('theme-selector-modal').classList.remove('active');
        }

        function loadTheme() {
            const saved = localStorage.getItem('dockview-theme');
            if (saved && THEMES[saved]) {
                applyTheme(saved);
            }
        }

        // Stats History System
        let statsHistory = new Map();  // Map<containerId, {timestamps: [], cpu: [], ram: []}>
        const MAX_HISTORY_POINTS = 60;  // Keep last 60 data points (10 minutes at 10s intervals)
        let cpuChart = null;
        let ramChart = null;

        function recordStats(containers) {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

            containers.forEach(container => {
                if (!statsHistory.has(container.id)) {
                    statsHistory.set(container.id, {
                        name: container.name,
                        timestamps: [],
                        cpu: [],
                        ram: []
                    });
                }

                const history = statsHistory.get(container.id);
                history.timestamps.push(timeStr);
                history.cpu.push(container.cpu || 0);
                history.ram.push(container.memory || 0);

                // Keep only last MAX_HISTORY_POINTS
                if (history.timestamps.length > MAX_HISTORY_POINTS) {
                    history.timestamps.shift();
                    history.cpu.shift();
                    history.ram.shift();
                }
            });
        }

        function viewStatsHistory(id, name) {
            const modal = document.getElementById('stats-history-modal');
            const containerName = document.getElementById('stats-container-name');

            containerName.textContent = name;
            modal.classList.add('active');

            const history = statsHistory.get(id);

            if (!history || history.timestamps.length === 0) {
                showToast('No stats history available yet. Data will appear after a few refresh cycles.', 'info');
                // Show empty charts
                renderStatsCharts(name, [], [], []);
                return;
            }

            renderStatsCharts(name, history.timestamps, history.cpu, history.ram);
        }

        function renderStatsCharts(name, timestamps, cpu, ram) {
            const cpuCtx = document.getElementById('cpu-chart').getContext('2d');
            const ramCtx = document.getElementById('ram-chart').getContext('2d');

            // Destroy existing charts if they exist
            if (cpuChart) {
                cpuChart.destroy();
            }
            if (ramChart) {
                ramChart.destroy();
            }

            // Create CPU chart
            cpuChart = new Chart(cpuCtx, {
                type: 'line',
                data: {
                    labels: timestamps,
                    datasets: [{
                        label: 'CPU Usage (%)',
                        data: cpu,
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 3,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0',
                                font: { size: 12 }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleColor: '#f97316',
                            bodyColor: '#e2e8f0',
                            borderColor: '#f97316',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#94a3b8',
                                maxRotation: 45,
                                minRotation: 45
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            }
                        }
                    }
                }
            });

            // Create RAM chart
            ramChart = new Chart(ramCtx, {
                type: 'line',
                data: {
                    labels: timestamps,
                    datasets: [{
                        label: 'RAM Usage (%)',
                        data: ram,
                        borderColor: '#a855f7',
                        backgroundColor: 'rgba(168, 85, 247, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 3,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0',
                                font: { size: 12 }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleColor: '#a855f7',
                            bodyColor: '#e2e8f0',
                            borderColor: '#a855f7',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#94a3b8',
                                maxRotation: 45,
                                minRotation: 45
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        function closeStatsHistory() {
            document.getElementById('stats-history-modal').classList.remove('active');
        }

        // Export System
        function openExportMenu() {
            document.getElementById('export-modal').classList.add('active');
        }

        function closeExportMenu() {
            document.getElementById('export-modal').classList.remove('active');
        }

        function downloadFile(filename, content, type = 'text/plain') {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function exportContainersCSV() {
            const headers = ['Name', 'Status', 'Image', 'CPU (%)', 'Memory (%)', 'Memory Text', 'Uptime', 'App Type', 'Favorite', 'Notes'];
            const rows = allContainers.map(c => [
                c.name,
                c.status,
                c.image,
                c.cpu ? c.cpu.toFixed(2) : '0',
                c.memory ? c.memory.toFixed(2) : '0',
                c.memory_text || 'N/A',
                c.uptime || 'N/A',
                c.appType || 'unknown',
                favoriteContainers.has(c.id) ? 'Yes' : 'No',
                containerNotes[c.id] || ''
            ]);

            const csv = [
                headers.join(','),
                ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
            ].join('\n');

            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            downloadFile(`dockview-containers-${timestamp}.csv`, csv, 'text/csv');
            showToast('âœ“ Containers exported as CSV', 'success');
        }

        function exportContainersJSON() {
            const data = {
                exported_at: new Date().toISOString(),
                total_containers: allContainers.length,
                containers: allContainers.map(c => ({
                    id: c.id,
                    name: c.name,
                    status: c.status,
                    image: c.image,
                    cpu: c.cpu,
                    memory: c.memory,
                    memory_text: c.memory_text,
                    uptime: c.uptime,
                    app_type: c.appType,
                    is_favorite: favoriteContainers.has(c.id),
                    notes: containerNotes[c.id] || null
                }))
            };

            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            downloadFile(`dockview-containers-${timestamp}.json`, JSON.stringify(data, null, 2), 'application/json');
            showToast('âœ“ Containers exported as JSON', 'success');
        }

        function exportStatsHistoryCSV() {
            if (statsHistory.size === 0) {
                showToast('No stats history available yet', 'warning');
                return;
            }

            let csv = 'Container Name,Timestamp,CPU (%),RAM (%)\n';

            statsHistory.forEach((history, containerId) => {
                history.timestamps.forEach((timestamp, i) => {
                    csv += `"${history.name}","${timestamp}",${history.cpu[i]},${history.ram[i]}\n`;
                });
            });

            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            downloadFile(`dockview-stats-history-${timestamp}.csv`, csv, 'text/csv');
            showToast('âœ“ Stats history exported as CSV', 'success');
        }

        function exportStatsHistoryJSON() {
            if (statsHistory.size === 0) {
                showToast('No stats history available yet', 'warning');
                return;
            }

            const data = {
                exported_at: new Date().toISOString(),
                containers: {}
            };

            statsHistory.forEach((history, containerId) => {
                data.containers[containerId] = {
                    name: history.name,
                    data_points: history.timestamps.map((timestamp, i) => ({
                        timestamp: timestamp,
                        cpu: history.cpu[i],
                        ram: history.ram[i]
                    }))
                };
            });

            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            downloadFile(`dockview-stats-history-${timestamp}.json`, JSON.stringify(data, null, 2), 'application/json');
            showToast('âœ“ Stats history exported as JSON', 'success');
        }

        function exportSettings() {
            const settings = {
                exported_at: new Date().toISOString(),
                theme: localStorage.getItem('dockview-theme') || 'default',
                theme_mode: localStorage.getItem('dockview-theme-mode') || 'dark',
                view_mode: localStorage.getItem('dockview-viewmode') || 'grouped',
                favorites: JSON.parse(localStorage.getItem('dockview-favorites') || '[]'),
                notes: JSON.parse(localStorage.getItem('dockview-notes') || '{}'),
                notifications: JSON.parse(localStorage.getItem('dockview-notifications') || '{}')
            };

            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            downloadFile(`dockview-settings-${timestamp}.json`, JSON.stringify(settings, null, 2), 'application/json');
            showToast('âœ“ Settings exported as JSON', 'success');
        }

        // Network Topology Visualization
        let networkGraph = null;
        let networkData = { containers: [], networks: [], devices: [] };

        function openNetworkTopology() {
            document.getElementById('network-topology-modal').classList.add('active');
            setTimeout(() => {
                initNetworkGraph();
                loadNetworkData();
            }, 100);
        }

        function closeNetworkTopology() {
            document.getElementById('network-topology-modal').classList.remove('active');
        }

        function initNetworkGraph() {
            if (networkGraph) return;

            const container = document.getElementById('network-graph');
            const nodes = new vis.DataSet([]);
            const edges = new vis.DataSet([]);

            const data = { nodes: nodes, edges: edges };
            const options = {
                nodes: {
                    shape: 'dot',
                    size: 20,
                    font: {
                        size: 14,
                        color: '#e2e8f0'
                    },
                    borderWidth: 2,
                    shadow: true
                },
                edges: {
                    width: 2,
                    color: { color: 'rgba(99, 102, 241, 0.4)', highlight: 'rgba(99, 102, 241, 0.8)' },
                    smooth: {
                        type: 'continuous'
                    }
                },
                physics: {
                    forceAtlas2Based: {
                        gravitationalConstant: -50,
                        centralGravity: 0.01,
                        springLength: 200,
                        springConstant: 0.08
                    },
                    maxVelocity: 50,
                    solver: 'forceAtlas2Based',
                    timestep: 0.35,
                    stabilization: { iterations: 150 }
                },
                interaction: {
                    tooltipDelay: 200,
                    hideEdgesOnDrag: true
                }
            };

            networkGraph = new vis.Network(container, data, options);

            // Handle node clicks
            networkGraph.on('click', function (params) {
                if (params.nodes.length > 0) {
                    const nodeId = params.nodes[0];
                    showNodeInfo(nodeId);
                }
            });
        }

        async function loadNetworkData() {
            try {
                // Load Docker containers and networks
                const dockerData = {
                    containers: allContainers,
                    networks: await fetchDockerNetworks()
                };

                networkData.containers = dockerData.containers;
                networkData.networks = dockerData.networks;

                updateNetworkView();
                updateNetworkStats();
            } catch (error) {
                console.error('Error loading network data:', error);
                showToast('Error loading network data', 'error');
            }
        }

        async function fetchDockerNetworks() {
            try {
                const response = await fetch('/network/topology');
                return await response.json();
            } catch (error) {
                console.error('Error fetching Docker networks:', error);
                return [];
            }
        }

        async function scanNetwork() {
            const loading = document.getElementById('network-loading');
            loading.style.display = 'block';
            showToast('Scanning network... This may take a minute', 'info');

            try {
                const response = await fetch('/network/scan');
                const devices = await response.json();
                networkData.devices = devices;
                updateNetworkView();
                updateNetworkStats();
                showToast(`âœ“ Found ${devices.length} network devices`, 'success');
            } catch (error) {
                console.error('Error scanning network:', error);
                showToast('Error scanning network', 'error');
            } finally {
                loading.style.display = 'none';
            }
        }

        function updateNetworkView() {
            if (!networkGraph) return;

            const showContainers = document.getElementById('show-containers').checked;
            const showNetworks = document.getElementById('show-networks').checked;
            const showDevices = document.getElementById('show-devices').checked;

            const nodes = [];
            const edges = [];

            // Add Docker networks as nodes
            if (showNetworks) {
                networkData.networks.forEach(network => {
                    nodes.push({
                        id: `net-${network.id}`,
                        label: network.name,
                        color: '#06b6d4',
                        size: 30,
                        title: `Network: ${network.name}<br>Driver: ${network.driver}<br>Subnet: ${network.subnet || 'N/A'}`
                    });
                });
            }

            // Add containers as nodes and connect to networks
            if (showContainers) {
                networkData.containers.forEach(container => {
                    const color = container.status === 'running' ? '#10b981' : '#ef4444';
                    nodes.push({
                        id: `cont-${container.id}`,
                        label: container.name,
                        color: color,
                        size: 25,
                        title: `Container: ${container.name}<br>Status: ${container.status}<br>CPU: ${container.cpu}%<br>RAM: ${container.memory}%`
                    });

                    // Connect container to its networks
                    if (container.networks && showNetworks) {
                        container.networks.forEach(netName => {
                            const netNode = networkData.networks.find(n => n.name === netName);
                            if (netNode) {
                                edges.push({
                                    from: `cont-${container.id}`,
                                    to: `net-${netNode.id}`
                                });
                            }
                        });
                    }
                });
            }

            // Add network devices
            if (showDevices) {
                networkData.devices.forEach((device, idx) => {
                    nodes.push({
                        id: `dev-${idx}`,
                        label: device.hostname || device.ip,
                        color: '#a855f7',
                        size: 20,
                        title: `Device: ${device.hostname || 'Unknown'}<br>IP: ${device.ip}<br>MAC: ${device.mac || 'N/A'}`
                    });
                });
            }

            networkGraph.setData({ nodes: nodes, edges: edges });
        }

        function updateNetworkStats() {
            document.getElementById('topo-containers').textContent = networkData.containers.length;
            document.getElementById('topo-networks').textContent = networkData.networks.length;
            document.getElementById('topo-devices').textContent = networkData.devices.length;
        }

        function showNodeInfo(nodeId) {
            // This would show detailed info about the clicked node
            console.log('Node clicked:', nodeId);
        }

        // Monitor container states and send notifications
        function checkContainerAlerts(containers) {
            if (!notificationPreferences.enabled || Notification.permission !== 'granted') {
                return;
            }

            containers.forEach(container => {
                const prevState = previousContainerStates.get(container.id);

                if (prevState) {
                    // Check for stopped container
                    if (notificationPreferences.notifyStopped &&
                        prevState.status === 'running' &&
                        container.status !== 'running') {
                        sendNotification(
                            'ðŸ›‘ Container Stopped',
                            `${container.name} has stopped`,
                            'ðŸ›‘'
                        );
                    }

                    // Check for container restart (stopped then running)
                    if (notificationPreferences.notifyRestarted &&
                        prevState.status !== 'running' &&
                        container.status === 'running') {
                        sendNotification(
                            'ðŸ”„ Container Restarted',
                            `${container.name} is now running`,
                            'ðŸ”„'
                        );
                    }

                    // Check for high CPU (only for running containers)
                    if (notificationPreferences.notifyCPU &&
                        container.status === 'running' &&
                        container.cpu > 90 &&
                        prevState.cpu <= 90) {
                        sendNotification(
                            'ðŸ”¥ High CPU Usage',
                            `${container.name} - CPU at ${container.cpu.toFixed(1)}%`,
                            'ðŸ”¥'
                        );
                    }

                    // Check for high RAM (only for running containers)
                    if (notificationPreferences.notifyRAM &&
                        container.status === 'running' &&
                        container.memory > 90 &&
                        prevState.memory <= 90) {
                        sendNotification(
                            'ðŸ’¾ High RAM Usage',
                            `${container.name} - RAM at ${container.memory.toFixed(1)}%`,
                            'ðŸ’¾'
                        );
                    }
                }

                // Update previous state
                previousContainerStates.set(container.id, {
                    status: container.status,
                    cpu: container.cpu,
                    memory: container.memory
                });
            });
        }

        // Speedtest trigger function
        async function runSpeedtest() {
            const btn = document.getElementById('run-speedtest-btn');
            const btnText = document.getElementById('speedtest-btn-text');
            const btnIcon = btn.querySelector('i');

            try {
                // Disable button and show loading state
                btn.disabled = true;
                btnIcon.className = 'fas fa-spinner fa-spin mr-2';
                btnText.textContent = 'Running Test...';

                showToast('Starting speed test... This may take up to 60 seconds', 'info');

                const response = await fetch('/speedtest/run', { method: 'POST' });
                const result = await response.json();

                if (response.ok) {
                    showToast('Speed test started! Results will appear shortly.', 'success');

                    // Poll for new results every 5 seconds for up to 90 seconds
                    let attempts = 0;
                    const maxAttempts = 18;
                    const pollInterval = setInterval(async () => {
                        attempts++;
                        try {
                            const widgetResponse = await fetch('/widgets/all');
                            const widgetData = await widgetResponse.json();

                            if (widgetData.widgets && widgetData.widgets.speedtest) {
                                const speedtest = widgetData.widgets.speedtest;
                                const testTime = new Date(speedtest.timestamp);
                                const now = new Date();
                                const ageSeconds = (now - testTime) / 1000;

                                // If result is less than 5 seconds old, it's the new test
                                if (ageSeconds < 5) {
                                    clearInterval(pollInterval);
                                    showToast('Speed test complete! Dashboard updated.', 'success');

                                    // Refresh widgets to update gauges
                                    fetchWidgets();

                                    // Re-enable button
                                    btn.disabled = false;
                                    btnIcon.className = 'fas fa-check-circle mr-2';
                                    btnText.textContent = 'Test Complete';

                                    setTimeout(() => {
                                        btnIcon.className = 'fas fa-play-circle mr-2';
                                        btnText.textContent = 'Run Speed Test';
                                    }, 3000);
                                }
                            }
                        } catch (e) {
                            console.error('Error polling for speedtest results:', e);
                        }

                        if (attempts >= maxAttempts) {
                            clearInterval(pollInterval);
                            btn.disabled = false;
                            btnIcon.className = 'fas fa-play-circle mr-2';
                            btnText.textContent = 'Run Speed Test';
                            showToast('Speed test taking longer than expected. Check back shortly.', 'info');
                        }
                    }, 5000);
                } else {
                    throw new Error(result.detail || 'Failed to start speed test');
                }
            } catch (error) {
                console.error('Error running speedtest:', error);
                showToast('Failed to start speed test: ' + error.message, 'error');

                // Re-enable button
                btn.disabled = false;
                btnIcon.className = 'fas fa-play-circle mr-2';
                btnText.textContent = 'Run Speed Test';
            }
        }

        // Toast notifications
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = 'toast';

            const icons = {
                success: '<i class="fas fa-check-circle" style="color: var(--success)"></i>',
                error: '<i class="fas fa-exclamation-circle" style="color: var(--danger)"></i>',
                info: '<i class="fas fa-info-circle" style="color: var(--info)"></i>'
            };

            toast.innerHTML = `
                ${icons[type] || icons.info}
                <span>${message}</span>
            `;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Show keyboard shortcuts help
        function showKeyboardShortcutsHelp() {
            const shortcuts = [
                { key: '/', desc: 'Focus search' },
                { key: 'Ctrl+K', desc: 'Focus search' },
                { key: 'Esc', desc: 'Clear search' },
                { key: 'G', desc: 'Grid view' },
                { key: 'C', desc: 'Category/Grouped view' },
                { key: 'R', desc: 'Refresh containers' },
                { key: '?', desc: 'Show this help' }
            ];

            const helpText = shortcuts.map(s => `<strong>${s.key}</strong>: ${s.desc}`).join('<br>');
            showToast(`<div style="text-align: left; line-height: 1.8;">
                <div style="font-weight: 700; margin-bottom: 8px; font-size: 1.1em;">âŒ¨ï¸ Keyboard Shortcuts</div>
                ${helpText}
            </div>`, 'info');
        }

        // Chart creation functions
        let piholeChart = null;
        let gaugeDownload = null;
        let gaugeUpload = null;
        let gaugePing = null;
        let sparklineCpu = null;
        let sparklineRam = null;

        function createPiholeChart(piholeData) {
            const ctx = document.getElementById('pihole-chart');
            if (!ctx) return;

            // Destroy existing chart if it exists
            if (piholeChart) {
                piholeChart.destroy();
            }

            // Generate 24 hours of mock data (hourly)
            // In production, this would come from Pi-hole API's history endpoint
            const now = new Date();
            const labels = [];
            const blockedData = [];
            const totalData = [];

            const currentBlockRate = piholeData.percent_blocked / 100;

            for (let i = 23; i >= 0; i--) {
                const hour = new Date(now - i * 3600000);
                labels.push(hour.getHours() + ':00');

                // Generate realistic-looking data based on current block rate
                const variance = 0.8 + Math.random() * 0.4; // 80%-120% variance
                const hourlyQueries = Math.floor((piholeData.queries_today / 24) * variance);
                const hourlyBlocked = Math.floor(hourlyQueries * (currentBlockRate * (0.9 + Math.random() * 0.2)));

                totalData.push(hourlyQueries);
                blockedData.push(hourlyBlocked);
            }

            piholeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Blocked Queries',
                            data: blockedData,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0,
                            pointHoverRadius: 5
                        },
                        {
                            label: 'Total Queries',
                            data: totalData,
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0,
                            pointHoverRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#9ca3af',
                                font: { size: 11 },
                                usePointStyle: true,
                                padding: 10
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(17, 24, 39, 0.9)',
                            titleColor: '#f3f4f6',
                            bodyColor: '#d1d5db',
                            borderColor: '#6366f1',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: true
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: { size: 10 }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.02)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: { size: 10 },
                                maxRotation: 0,
                                autoSkip: true,
                                maxTicksLimit: 12
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }

        function createGaugeChart(canvasId, value, maxValue, label, colors) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;

            // Destroy existing chart
            const chartVar = canvasId.replace('gauge-', '');
            if (chartVar === 'download' && gaugeDownload) gaugeDownload.destroy();
            if (chartVar === 'upload' && gaugeUpload) gaugeUpload.destroy();
            if (chartVar === 'ping' && gaugePing) gaugePing.destroy();

            const percentage = Math.min((value / maxValue) * 100, 100);

            const chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [value, maxValue - value],
                        backgroundColor: [
                            colors.fill,
                            'rgba(31, 41, 55, 0.3)'
                        ],
                        borderColor: [
                            colors.border,
                            'transparent'
                        ],
                        borderWidth: 2,
                        circumference: 270,
                        rotation: 225
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    cutout: '75%',
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    },
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 2000,
                        easing: 'easeOutQuart'
                    }
                }
            });

            return chart;
        }

        function createSparkline(canvasId, data, color, gradientColor) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return null;

            // Destroy existing chart
            if (canvasId === 'sparkline-cpu' && sparklineCpu) sparklineCpu.destroy();
            if (canvasId === 'sparkline-ram' && sparklineRam) sparklineRam.destroy();

            // Create gradient
            const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 30);
            gradient.addColorStop(0, gradientColor + '60');
            gradient.addColorStop(1, gradientColor + '00');

            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map((_, i) => i),
                    datasets: [{
                        data: data,
                        borderColor: color,
                        backgroundColor: gradient,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 0
                    }]
                },
                options: {
                    responsive: false,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    },
                    animation: {
                        duration: 750,
                        easing: 'easeInOutQuart'
                    }
                }
            });

            return chart;
        }

        // Number animation utilities
        function animateNumber(element, start, end, duration = 1000, suffix = '', prefix = '') {
            if (!element) return;

            const startTime = performance.now();
            const range = end - start;

            // Easing function for smooth deceleration
            const easeOutQuart = (t) => 1 - Math.pow(1 - t, 4);

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easedProgress = easeOutQuart(progress);
                const currentValue = start + (range * easedProgress);

                // Format the number based on its size
                let displayValue;
                if (end >= 1000) {
                    displayValue = Math.floor(currentValue).toLocaleString();
                } else if (end >= 100) {
                    displayValue = Math.floor(currentValue);
                } else if (end >= 10) {
                    displayValue = currentValue.toFixed(1);
                } else {
                    displayValue = currentValue.toFixed(2);
                }

                element.textContent = prefix + displayValue + suffix;

                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }

            requestAnimationFrame(update);
        }

        // Widget functions (with error handling and fast timeout)
        async function fetchWidgets() {
            try {
                const startTime = performance.now();
                console.log('ðŸ“Š Fetching widgets...');

                // Set a timeout for widget fetching to not block the UI
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 8000); // 8 second frontend timeout (match backend)

                const response = await fetch('/widgets/all', { signal: controller.signal });
                clearTimeout(timeoutId);
                const data = await response.json();

                const elapsed = ((performance.now() - startTime) / 1000).toFixed(2);
                console.log(`âœ“ Fetched widgets in ${elapsed}s`);

                if (!data.enabled) {
                    console.log('â„¹ Widgets are disabled in config');
                    return;
                }

                const widgetsSection = document.getElementById('widgets-section');
                widgetsSection.style.display = 'block';

                const widgets = data.widgets;
                let visibleWidgets = 0;

                // Update Tautulli widget
                if (widgets.tautulli && widgets.tautulli.available) {
                    console.log('ðŸ“º Tautulli data:', widgets.tautulli);
                    document.getElementById('widget-tautulli').style.display = 'block';
                    animateNumber(document.getElementById('tautulli-movies'), 0, widgets.tautulli.total_movies || 0, 1200);
                    animateNumber(document.getElementById('tautulli-shows'), 0, widgets.tautulli.total_shows || 0, 1300);
                    animateNumber(document.getElementById('tautulli-episodes'), 0, widgets.tautulli.total_episodes || 0, 1400);
                    animateNumber(document.getElementById('tautulli-plays'), 0, widgets.tautulli.plays_today || 0, 1000);
                    visibleWidgets++;
                }

                // Update Pi-hole widget
                if (widgets.pihole && widgets.pihole.available) {
                    console.log('ðŸ›¡ï¸ Pi-hole data:', widgets.pihole);
                    document.getElementById('widget-pihole').style.display = 'block';
                    animateNumber(document.getElementById('pihole-blocked'), 0, widgets.pihole.blocked_today || 0, 1400);
                    animateNumber(document.getElementById('pihole-percent'), 0, widgets.pihole.percent_blocked || 0, 1200, '%');
                    animateNumber(document.getElementById('pihole-queries'), 0, widgets.pihole.queries_today || 0, 1500);

                    // Create Pi-hole blocking trends chart
                    createPiholeChart(widgets.pihole);
                    visibleWidgets++;
                }

                // Update Overseerr widget
                if (widgets.overseerr && widgets.overseerr.available) {
                    console.log('ðŸŽ« Overseerr data:', widgets.overseerr);
                    document.getElementById('widget-overseerr').style.display = 'block';
                    document.getElementById('overseerr-pending').textContent = widgets.overseerr.pending_requests || 0;
                    document.getElementById('overseerr-total').textContent = widgets.overseerr.total_requests || 0;
                    visibleWidgets++;
                }

                // Update Sonarr widget
                if (widgets.sonarr && widgets.sonarr.available) {
                    console.log('ðŸ“º Sonarr data:', widgets.sonarr);
                    document.getElementById('widget-sonarr').style.display = 'block';
                    document.getElementById('sonarr-shows').textContent = (widgets.sonarr.total_shows || 0).toLocaleString();
                    document.getElementById('sonarr-episodes').textContent = (widgets.sonarr.total_episodes || 0).toLocaleString();
                    document.getElementById('sonarr-monitored').textContent = (widgets.sonarr.monitored_shows || 0).toLocaleString();
                    document.getElementById('sonarr-queue').textContent = widgets.sonarr.queue_count || 0;
                    visibleWidgets++;
                }

                // Update Radarr widget
                if (widgets.radarr && widgets.radarr.available) {
                    console.log('ðŸŽ¬ Radarr data:', widgets.radarr);
                    document.getElementById('widget-radarr').style.display = 'block';
                    document.getElementById('radarr-total').textContent = (widgets.radarr.total_movies || 0).toLocaleString();
                    document.getElementById('radarr-downloaded').textContent = (widgets.radarr.downloaded_movies || 0).toLocaleString();
                    document.getElementById('radarr-monitored').textContent = (widgets.radarr.monitored_movies || 0).toLocaleString();
                    document.getElementById('radarr-queue').textContent = widgets.radarr.queue_count || 0;
                    visibleWidgets++;
                }

                // Update Tdarr widget
                if (widgets.tdarr && widgets.tdarr.available) {
                    console.log('ðŸ’¿ Tdarr data:', widgets.tdarr);
                    document.getElementById('widget-tdarr').style.display = 'block';
                    document.getElementById('tdarr-queue').textContent = widgets.tdarr.queue_count || 0;
                    document.getElementById('tdarr-processing').textContent = widgets.tdarr.processing || 0;
                    visibleWidgets++;
                }

                // Update Prowlarr widget
                if (widgets.prowlarr && widgets.prowlarr.available) {
                    console.log('ðŸ” Prowlarr data:', widgets.prowlarr);
                    document.getElementById('widget-prowlarr').style.display = 'block';
                    document.getElementById('prowlarr-enabled').textContent = widgets.prowlarr.enabled_indexers || 0;
                    document.getElementById('prowlarr-total').textContent = widgets.prowlarr.total_indexers || 0;
                    visibleWidgets++;
                }

                // Update Scrutiny widget
                if (widgets.scrutiny && widgets.scrutiny.available) {
                    console.log('ðŸ’½ Scrutiny data:', widgets.scrutiny);
                    document.getElementById('widget-scrutiny').style.display = 'block';
                    document.getElementById('scrutiny-devices').textContent = widgets.scrutiny.total_devices || 0;

                    // Temperature with color coding
                    const temp = widgets.scrutiny.avg_temp || 0;
                    const tempElement = document.getElementById('scrutiny-temp');
                    if (temp > 0) {
                        tempElement.textContent = temp + 'Â°C';
                        // Color code: green < 45Â°C, yellow 45-55Â°C, red > 55Â°C
                        if (temp > 55) {
                            tempElement.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                        } else if (temp > 45) {
                            tempElement.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
                        } else {
                            tempElement.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                        }
                        tempElement.style.webkitBackgroundClip = 'text';
                        tempElement.style.webkitTextFillColor = 'transparent';
                    }

                    const critical = widgets.scrutiny.critical || 0;
                    const criticalElement = document.getElementById('scrutiny-critical');
                    criticalElement.textContent = critical;
                    if (critical > 0) {
                        criticalElement.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                        criticalElement.style.webkitBackgroundClip = 'text';
                        criticalElement.style.webkitTextFillColor = 'transparent';
                    }

                    // Status indicator
                    const statusElement = document.getElementById('scrutiny-status');
                    if (critical > 0) {
                        statusElement.textContent = 'âš ';
                        statusElement.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                    } else {
                        statusElement.textContent = 'âœ“';
                        statusElement.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                    }
                    statusElement.style.webkitBackgroundClip = 'text';
                    statusElement.style.webkitTextFillColor = 'transparent';

                    visibleWidgets++;
                }

                // Update Speedtest widget and hero section
                if (widgets.speedtest && widgets.speedtest.available) {
                    console.log('ðŸŽ¯ Showing speedtest hero section with data:', widgets.speedtest);

                    // Show and update hero section
                    const heroSection = document.getElementById('hero-speedtest');
                    heroSection.style.display = 'block';

                    // Create gauge charts with beautiful gradients
                    const downloadSpeed = widgets.speedtest.download || 0;
                    const uploadSpeed = widgets.speedtest.upload || 0;
                    const pingMs = widgets.speedtest.ping || 0;

                    // Download gauge (green) - max 1000 Mbps
                    gaugeDownload = createGaugeChart('gauge-download', downloadSpeed, 1000, 'Download', {
                        fill: 'rgba(16, 185, 129, 0.8)',
                        border: 'rgb(16, 185, 129)'
                    });

                    // Upload gauge (blue) - max 100 Mbps
                    gaugeUpload = createGaugeChart('gauge-upload', uploadSpeed, 100, 'Upload', {
                        fill: 'rgba(59, 130, 246, 0.8)',
                        border: 'rgb(59, 130, 246)'
                    });

                    // Ping gauge (purple) - max 100ms (lower is better, inverted display)
                    gaugePing = createGaugeChart('gauge-ping', Math.min(pingMs, 100), 100, 'Latency', {
                        fill: 'rgba(168, 85, 247, 0.8)',
                        border: 'rgb(168, 85, 247)'
                    });

                    // Update numbers with animations
                    animateNumber(document.getElementById('hero-download'), 0, downloadSpeed, 2000);
                    animateNumber(document.getElementById('hero-upload'), 0, uploadSpeed, 2000);
                    animateNumber(document.getElementById('hero-ping'), 0, pingMs, 2000);

                    document.getElementById('hero-speedtest-server').textContent = `Server: ${widgets.speedtest.server || 'Unknown'}`;

                    if (widgets.speedtest.timestamp) {
                        const date = new Date(widgets.speedtest.timestamp);
                        const timeStr = date.toLocaleString();
                        document.getElementById('hero-speedtest-time').textContent = `Last tested: ${timeStr}`;
                    }

                    // Update speedtest widget
                    document.getElementById('widget-speedtest').style.display = 'block';
                    document.getElementById('speedtest-download').textContent = widgets.speedtest.download.toFixed(1);
                    document.getElementById('speedtest-upload').textContent = widgets.speedtest.upload.toFixed(1);
                    visibleWidgets++;

                    console.log(`âœ… Hero section now visible! Download: ${widgets.speedtest.download} Mbps, Upload: ${widgets.speedtest.upload} Mbps`);

                    // Scroll to hero section smoothly to make it visible
                    setTimeout(() => {
                        heroSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 100);
                }

                // Update Uptime Kuma widget
                if (widgets.uptime_kuma && widgets.uptime_kuma.available) {
                    console.log('ðŸ’š Uptime Kuma data:', widgets.uptime_kuma);
                    document.getElementById('widget-uptime').style.display = 'block';

                    // Update title with status page name
                    const title = widgets.uptime_kuma.status_page_title || 'Status Page';
                    document.getElementById('uptime-title').textContent = title;

                    // Update monitor count
                    document.getElementById('uptime-monitors').textContent = widgets.uptime_kuma.total_monitors || 0;

                    // Update monitor names list
                    const names = widgets.uptime_kuma.monitor_names || [];
                    document.getElementById('uptime-names').textContent = names.join(', ') || 'No monitors';

                    visibleWidgets++;
                }

                // Update Portainer widget
                if (widgets.portainer && widgets.portainer.available) {
                    console.log('ðŸ³ Portainer data:', widgets.portainer);
                    document.getElementById('widget-portainer').style.display = 'block';

                    // Update title with endpoint name
                    const endpointName = widgets.portainer.endpoint_name || 'Docker';
                    document.getElementById('portainer-title').textContent = endpointName;

                    // Update stats
                    document.getElementById('portainer-containers').textContent = widgets.portainer.total_containers || 0;
                    document.getElementById('portainer-running').textContent = widgets.portainer.running_containers || 0;
                    document.getElementById('portainer-stacks').textContent = widgets.portainer.total_stacks || 0;
                    document.getElementById('portainer-volumes').textContent = widgets.portainer.total_volumes || 0;

                    visibleWidgets++;
                }

                console.log(`âœ“ Displayed ${visibleWidgets} widgets`);
                console.log('ðŸ“Š Full widget response:', data.widgets);

                // Update widget count in stats summary
                document.getElementById('stat-widgets').textContent = visibleWidgets;

                // Show toast notification when widgets load
                if (visibleWidgets > 0) {
                    showToast(`Loaded ${visibleWidgets} widget${visibleWidgets > 1 ? 's' : ''}`, 'success');
                } else {
                    console.warn('âš ï¸ No widgets displayed - check API keys in config.yaml');
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.warn('â± Widget fetch timed out after 8 seconds');
                } else {
                    console.error('âŒ Error fetching widgets:', error);
                }
                // Don't block the UI - just log and continue
            }
        }

        // Auto-refresh
        // Auto-refresh state
        let autoRefreshEnabled = true;
        let containerRefreshInterval = null;
        let widgetRefreshInterval = null;

        // Start auto-refresh intervals
        function startAutoRefresh() {
            if (containerRefreshInterval) clearInterval(containerRefreshInterval);
            if (widgetRefreshInterval) clearInterval(widgetRefreshInterval);

            containerRefreshInterval = setInterval(fetchContainers, 10000);
            widgetRefreshInterval = setInterval(fetchWidgets, 30000);
        }

        // Stop auto-refresh intervals
        function stopAutoRefresh() {
            if (containerRefreshInterval) clearInterval(containerRefreshInterval);
            if (widgetRefreshInterval) clearInterval(widgetRefreshInterval);
        }

        // Toggle auto-refresh
        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const btn = document.getElementById('toggle-auto-refresh');
            const statusText = document.getElementById('refresh-status').querySelector('span');

            if (autoRefreshEnabled) {
                startAutoRefresh();
                btn.innerHTML = '<i class="fas fa-pause mr-2"></i>Pause';
                btn.classList.remove('bg-red-500/20', 'border-red-500/40', 'hover:bg-red-500/30');
                btn.classList.add('bg-indigo-500/20', 'border-indigo-500/40', 'hover:bg-indigo-500/30');
                statusText.textContent = 'Every 10s';
                showToast('Auto-refresh enabled', 'success');
            } else {
                stopAutoRefresh();
                btn.innerHTML = '<i class="fas fa-play mr-2"></i>Resume';
                btn.classList.remove('bg-indigo-500/20', 'border-indigo-500/40', 'hover:bg-indigo-500/30');
                btn.classList.add('bg-red-500/20', 'border-red-500/40', 'hover:bg-red-500/30');
                statusText.textContent = 'Paused';
                statusText.classList.add('text-red-400');
                showToast('Auto-refresh paused', 'info');
            }
        }

        // Show refresh spinner animation
        function showRefreshIndicator() {
            const spinner = document.getElementById('refresh-spinner');
            spinner.style.opacity = '1';
            spinner.style.animation = 'spin 1s linear infinite';
        }

        // Hide refresh spinner animation
        function hideRefreshIndicator() {
            const spinner = document.getElementById('refresh-spinner');
            spinner.style.opacity = '0';
            spinner.style.animation = '';
        }

        // Update last updated timestamp
        function updateLastRefreshTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            });
            document.getElementById('last-updated').textContent = `Updated ${timeStr}`;
        }

        // Dark Mode Toggle
        function toggleDarkMode() {
            const body = document.body;
            const icon = document.getElementById('dark-mode-icon');
            const text = document.getElementById('dark-mode-text');

            body.classList.toggle('light-mode');
            const isLightMode = body.classList.contains('light-mode');

            if (isLightMode) {
                icon.className = 'fas fa-sun mr-2';
                text.textContent = 'Light';
                localStorage.setItem('dockview-theme-mode', 'light');
                showToast('â˜€ï¸ Light mode enabled', 'success');
            } else {
                icon.className = 'fas fa-moon mr-2';
                text.textContent = 'Dark';
                localStorage.setItem('dockview-theme-mode', 'dark');
                showToast('ðŸŒ™ Dark mode enabled', 'success');
            }
        }

        // Initialize dark mode from localStorage
        function initializeDarkMode() {
            const savedMode = localStorage.getItem('dockview-theme-mode');
            const icon = document.getElementById('dark-mode-icon');
            const text = document.getElementById('dark-mode-text');

            if (savedMode === 'light') {
                document.body.classList.add('light-mode');
                icon.className = 'fas fa-sun mr-2';
                text.textContent = 'Light';
            }
            // Default is dark mode, so no action needed if savedMode is null or 'dark'
        }

        // Wrap fetch functions to show indicators
        const originalFetchContainers = fetchContainers;
        fetchContainers = async function() {
            showRefreshIndicator();
            try {
                await originalFetchContainers();
                updateLastRefreshTime();
            } finally {
                setTimeout(hideRefreshIndicator, 500); // Keep spinner visible for 500ms
            }
        };

        // Start auto-refresh
        startAutoRefresh();

        // Initialize view mode toggle buttons based on saved preference
        initializeViewMode();

        // Initial fetch - containers first for instant display, widgets after
        fetchContainers();
        // Delay widget fetch slightly to prioritize container display
        setTimeout(fetchWidgets, 500);

        // Load notification preferences
        loadNotificationPreferences();

        // Load saved theme
        loadTheme();

        // Load favorites
        loadFavorites();

        // Load notes
        loadNotes();

        // Initialize dark mode
        initializeDarkMode();
    </script>

    <!-- Logs Modal -->
    <div id="logs-modal" class="modal">
        <div class="modal-content" style="width: 1200px;">
            <div class="modal-header">
                <h2 class="text-2xl font-bold">
                    <i class="fas fa-file-alt mr-3"></i>
                    Container Logs: <span id="logs-container-name"></span>
                </h2>
                <button class="modal-close ripple" onclick="closeLogsModal()">
                    <i class="fas fa-times mr-2"></i>Close
                </button>
            </div>
            <div class="modal-body">
                <div id="logs-loading" style="text-align: center; padding: 2rem;">
                    <div class="spinner" style="margin: 0 auto;"></div>
                    <p class="mt-4 text-gray-400">Loading logs...</p>
                </div>
                <div id="logs-content" class="logs-container" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Container Details Modal -->
    <div id="details-modal" class="modal">
        <div class="modal-content" style="width: 1000px;">
            <div class="modal-header">
                <h2 class="text-2xl font-bold">
                    <i class="fas fa-info-circle mr-3"></i>
                    Container Details: <span id="details-container-name"></span>
                </h2>
                <button class="modal-close ripple" onclick="closeDetailsModal()">
                    <i class="fas fa-times mr-2"></i>Close
                </button>
            </div>
            <div class="modal-body">
                <div id="details-loading" style="text-align: center; padding: 2rem;">
                    <div class="spinner" style="margin: 0 auto;"></div>
                    <p class="mt-4 text-gray-400">Loading details...</p>
                </div>
                <div id="details-content" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Notes Modal -->
    <div id="notes-modal" class="modal">
        <div class="modal-content" style="width: 600px;">
            <div class="modal-header">
                <h2 class="text-2xl font-bold">
                    <i class="fas fa-sticky-note mr-3 text-blue-400"></i>
                    Container Notes: <span id="notes-container-name"></span>
                </h2>
                <button class="modal-close ripple" onclick="closeNotesModal()">
                    <i class="fas fa-times mr-2"></i>Close
                </button>
            </div>
            <div class="modal-body">
                <div class="space-y-4">
                    <div>
                        <label for="notes-textarea" class="block text-sm font-semibold text-gray-300 mb-2">
                            <i class="fas fa-edit mr-2"></i>Add your notes or annotations:
                        </label>
                        <textarea id="notes-textarea"
                                  rows="8"
                                  placeholder="Add notes about this container... (e.g., configuration details, troubleshooting tips, maintenance reminders)"
                                  class="w-full px-4 py-3 rounded-xl bg-gray-800/60 border border-gray-600/40 text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 resize-vertical"></textarea>
                    </div>
                    <div class="flex gap-3 justify-end">
                        <button onclick="deleteNote()" class="px-4 py-2 rounded-lg bg-red-500/20 text-red-300 border border-red-500/40 hover:bg-red-500/30 transition-all ripple text-sm font-semibold">
                            <i class="fas fa-trash mr-2"></i>Delete Note
                        </button>
                        <button onclick="saveNote()" class="px-4 py-2 rounded-lg bg-blue-500/20 text-blue-300 border border-blue-500/40 hover:bg-blue-500/30 transition-all ripple text-sm font-semibold">
                            <i class="fas fa-save mr-2"></i>Save Note
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Settings Modal -->
    <div id="notification-settings-modal" class="modal">
        <div class="modal-content" style="width: 600px;">
            <div class="modal-header">
                <h2 class="text-2xl font-bold">
                    <i class="fas fa-bell mr-3"></i>
                    Notification Settings
                </h2>
                <button class="modal-close ripple" onclick="closeNotificationSettings()">
                    <i class="fas fa-times mr-2"></i>Close
                </button>
            </div>
            <div class="modal-body">
                <div class="space-y-6">
                    <!-- Permission Status -->
                    <div class="glass p-4 rounded-xl">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold text-indigo-400">
                                <i class="fas fa-shield-alt mr-2"></i>Browser Permissions
                            </h3>
                            <span id="permission-status" class="px-3 py-1 rounded-lg text-xs font-semibold bg-gray-500/20 text-gray-300">
                                Not Granted
                            </span>
                        </div>
                        <button id="request-permission-btn" onclick="requestNotificationPermission()" class="px-4 py-2 rounded-lg bg-indigo-500/20 text-indigo-300 border border-indigo-500/40 hover:bg-indigo-500/30 transition-all ripple text-sm font-semibold">
                            <i class="fas fa-unlock mr-2"></i>Enable Notifications
                        </button>
                    </div>

                    <!-- Notification Preferences -->
                    <div class="glass p-4 rounded-xl">
                        <h3 class="text-lg font-bold text-indigo-400 mb-4">
                            <i class="fas fa-sliders-h mr-2"></i>Alert Preferences
                        </h3>
                        <div class="space-y-3">
                            <label class="flex items-center justify-between p-3 rounded-lg bg-gray-800/40 hover:bg-gray-800/60 transition-all cursor-pointer">
                                <span class="flex items-center gap-3">
                                    <i class="fas fa-stop-circle text-red-400"></i>
                                    <span class="text-sm font-semibold">Container Stopped</span>
                                </span>
                                <input type="checkbox" id="notify-stopped" class="w-5 h-5 rounded border-2 border-indigo-500/50 bg-gray-800/80 text-indigo-500 focus:ring-2 focus:ring-indigo-500/50 cursor-pointer">
                            </label>

                            <label class="flex items-center justify-between p-3 rounded-lg bg-gray-800/40 hover:bg-gray-800/60 transition-all cursor-pointer">
                                <span class="flex items-center gap-3">
                                    <i class="fas fa-fire text-orange-400"></i>
                                    <span class="text-sm font-semibold">High CPU Usage (>90%)</span>
                                </span>
                                <input type="checkbox" id="notify-cpu" class="w-5 h-5 rounded border-2 border-indigo-500/50 bg-gray-800/80 text-indigo-500 focus:ring-2 focus:ring-indigo-500/50 cursor-pointer">
                            </label>

                            <label class="flex items-center justify-between p-3 rounded-lg bg-gray-800/40 hover:bg-gray-800/60 transition-all cursor-pointer">
                                <span class="flex items-center gap-3">
                                    <i class="fas fa-memory text-purple-400"></i>
                                    <span class="text-sm font-semibold">High RAM Usage (>90%)</span>
                                </span>
                                <input type="checkbox" id="notify-ram" class="w-5 h-5 rounded border-2 border-indigo-500/50 bg-gray-800/80 text-indigo-500 focus:ring-2 focus:ring-indigo-500/50 cursor-pointer">
                            </label>

                            <label class="flex items-center justify-between p-3 rounded-lg bg-gray-800/40 hover:bg-gray-800/60 transition-all cursor-pointer">
                                <span class="flex items-center gap-3">
                                    <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                                    <span class="text-sm font-semibold">Container Restarted</span>
                                </span>
                                <input type="checkbox" id="notify-restarted" class="w-5 h-5 rounded border-2 border-indigo-500/50 bg-gray-800/80 text-indigo-500 focus:ring-2 focus:ring-indigo-500/50 cursor-pointer">
                            </label>
                        </div>
                    </div>

                    <!-- Test Notification -->
                    <div class="glass p-4 rounded-xl">
                        <button onclick="sendTestNotification()" class="w-full px-4 py-2 rounded-lg bg-green-500/20 text-green-300 border border-green-500/40 hover:bg-green-500/30 transition-all ripple text-sm font-semibold">
                            <i class="fas fa-paper-plane mr-2"></i>Send Test Notification
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Selector Modal -->
    <div id="theme-selector-modal" class="modal">
        <div class="modal-content" style="width: 700px;">
            <div class="modal-header">
                <h2 class="text-2xl font-bold">
                    <i class="fas fa-palette mr-3"></i>
                    Theme Selector
                </h2>
                <button class="modal-close ripple" onclick="closeThemeSelector()">
                    <i class="fas fa-times mr-2"></i>Close
                </button>
            </div>
            <div class="modal-body">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Default Theme -->
                    <button onclick="applyTheme('default')" class="theme-card group">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold">Indigo Wave</h3>
                            <i id="theme-check-default" class="fas fa-check-circle text-indigo-400 text-2xl" style="display: none;"></i>
                        </div>
                        <div class="flex gap-2 mb-3">
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);"></div>
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #1f2649, #1d2342);"></div>
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #0f172a, #1e293b);"></div>
                        </div>
                        <p class="text-xs text-gray-400">Classic blue & purple gradient</p>
                    </button>

                    <!-- Green Theme -->
                    <button onclick="applyTheme('green')" class="theme-card group">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold">Emerald Forest</h3>
                            <i id="theme-check-green" class="fas fa-check-circle text-green-400 text-2xl" style="display: none;"></i>
                        </div>
                        <div class="flex gap-2 mb-3">
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #10b981, #059669);"></div>
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #064e3b, #022c22);"></div>
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #0f172a, #1e293b);"></div>
                        </div>
                        <p class="text-xs text-gray-400">Refreshing green tones</p>
                    </button>

                    <!-- Cyberpunk Theme -->
                    <button onclick="applyTheme('cyberpunk')" class="theme-card group">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold">Neon Cyberpunk</h3>
                            <i id="theme-check-cyberpunk" class="fas fa-check-circle text-pink-400 text-2xl" style="display: none;"></i>
                        </div>
                        <div class="flex gap-2 mb-3">
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #ec4899, #f97316);"></div>
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #7c3aed, #a855f7);"></div>
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #18181b, #27272a);"></div>
                        </div>
                        <p class="text-xs text-gray-400">Electric pink & neon vibes</p>
                    </button>

                    <!-- Ocean Theme -->
                    <button onclick="applyTheme('ocean')" class="theme-card group">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold">Deep Ocean</h3>
                            <i id="theme-check-ocean" class="fas fa-check-circle text-cyan-400 text-2xl" style="display: none;"></i>
                        </div>
                        <div class="flex gap-2 mb-3">
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #06b6d4, #0891b2);"></div>
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #164e63, #083344);"></div>
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #0c4a6e, #075985);"></div>
                        </div>
                        <p class="text-xs text-gray-400">Cool cyan & blue depths</p>
                    </button>

                    <!-- Sunset Theme -->
                    <button onclick="applyTheme('sunset')" class="theme-card group">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold">Warm Sunset</h3>
                            <i id="theme-check-sunset" class="fas fa-check-circle text-orange-400 text-2xl" style="display: none;"></i>
                        </div>
                        <div class="flex gap-2 mb-3">
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #f97316, #ea580c);"></div>
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #fbbf24, #f59e0b);"></div>
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #7c2d12, #431407);"></div>
                        </div>
                        <p class="text-xs text-gray-400">Warm orange & amber hues</p>
                    </button>

                    <!-- Dark Purple Theme -->
                    <button onclick="applyTheme('darkpurple')" class="theme-card group">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold">Dark Violet</h3>
                            <i id="theme-check-darkpurple" class="fas fa-check-circle text-purple-400 text-2xl" style="display: none;"></i>
                        </div>
                        <div class="flex gap-2 mb-3">
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #a855f7, #9333ea);"></div>
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #581c87, #3b0764);"></div>
                            <div class="w-12 h-12 rounded-lg" style="background: linear-gradient(135deg, #18181b, #27272a);"></div>
                        </div>
                        <p class="text-xs text-gray-400">Rich purple mystique</p>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats History Modal -->
    <div id="stats-history-modal" class="modal">
        <div class="modal-content" style="width: 1000px;">
            <div class="modal-header">
                <h2 class="text-2xl font-bold">
                    <i class="fas fa-chart-line mr-3"></i>
                    Stats History: <span id="stats-container-name"></span>
                </h2>
                <button class="modal-close ripple" onclick="closeStatsHistory()">
                    <i class="fas fa-times mr-2"></i>Close
                </button>
            </div>
            <div class="modal-body">
                <div class="space-y-6">
                    <div class="glass p-4 rounded-xl">
                        <h3 class="text-lg font-bold text-orange-400 mb-4">
                            <i class="fas fa-microchip mr-2"></i>CPU Usage Over Time
                        </h3>
                        <canvas id="cpu-chart" height="100"></canvas>
                    </div>

                    <div class="glass p-4 rounded-xl">
                        <h3 class="text-lg font-bold text-purple-400 mb-4">
                            <i class="fas fa-memory mr-2"></i>RAM Usage Over Time
                        </h3>
                        <canvas id="ram-chart" height="100"></canvas>
                    </div>

                    <div class="glass p-4 rounded-xl">
                        <p class="text-xs text-gray-400 text-center">
                            <i class="fas fa-info-circle mr-2"></i>
                            Stats are collected every 10 seconds. History is retained for the current session only.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Menu Modal -->
    <div id="export-modal" class="modal">
        <div class="modal-content" style="width: 600px;">
            <div class="modal-header">
                <h2 class="text-2xl font-bold">
                    <i class="fas fa-download mr-3"></i>
                    Export Data
                </h2>
                <button class="modal-close ripple" onclick="closeExportMenu()">
                    <i class="fas fa-times mr-2"></i>Close
                </button>
            </div>
            <div class="modal-body">
                <div class="space-y-4">
                    <!-- Export Container Stats -->
                    <div class="glass p-4 rounded-xl">
                        <h3 class="text-lg font-bold text-indigo-400 mb-3">
                            <i class="fas fa-table mr-2"></i>Container Stats
                        </h3>
                        <p class="text-xs text-gray-400 mb-4">Export all container statistics and information</p>
                        <div class="flex gap-2">
                            <button onclick="exportContainersCSV()" class="flex-1 px-4 py-2 rounded-lg bg-green-500/20 text-green-300 border border-green-500/40 hover:bg-green-500/30 transition-all ripple text-sm font-semibold">
                                <i class="fas fa-file-csv mr-2"></i>CSV
                            </button>
                            <button onclick="exportContainersJSON()" class="flex-1 px-4 py-2 rounded-lg bg-blue-500/20 text-blue-300 border border-blue-500/40 hover:bg-blue-500/30 transition-all ripple text-sm font-semibold">
                                <i class="fas fa-file-code mr-2"></i>JSON
                            </button>
                        </div>
                    </div>

                    <!-- Export Stats History -->
                    <div class="glass p-4 rounded-xl">
                        <h3 class="text-lg font-bold text-orange-400 mb-3">
                            <i class="fas fa-chart-line mr-2"></i>Stats History
                        </h3>
                        <p class="text-xs text-gray-400 mb-4">Export historical CPU/RAM data for all containers</p>
                        <div class="flex gap-2">
                            <button onclick="exportStatsHistoryCSV()" class="flex-1 px-4 py-2 rounded-lg bg-green-500/20 text-green-300 border border-green-500/40 hover:bg-green-500/30 transition-all ripple text-sm font-semibold">
                                <i class="fas fa-file-csv mr-2"></i>CSV
                            </button>
                            <button onclick="exportStatsHistoryJSON()" class="flex-1 px-4 py-2 rounded-lg bg-blue-500/20 text-blue-300 border border-blue-500/40 hover:bg-blue-500/30 transition-all ripple text-sm font-semibold">
                                <i class="fas fa-file-code mr-2"></i>JSON
                            </button>
                        </div>
                    </div>

                    <!-- Export Settings -->
                    <div class="glass p-4 rounded-xl">
                        <h3 class="text-lg font-bold text-purple-400 mb-3">
                            <i class="fas fa-cog mr-2"></i>Dashboard Settings
                        </h3>
                        <p class="text-xs text-gray-400 mb-4">Export your favorites, theme, and notification preferences</p>
                        <button onclick="exportSettings()" class="w-full px-4 py-2 rounded-lg bg-purple-500/20 text-purple-300 border border-purple-500/40 hover:bg-purple-500/30 transition-all ripple text-sm font-semibold">
                            <i class="fas fa-file-export mr-2"></i>Export Settings (JSON)
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Network Topology Modal -->
    <div id="network-topology-modal" class="modal">
        <div class="modal-content" style="width: 95vw; max-width: 1400px; height: 90vh;">
            <div class="modal-header">
                <h2 class="text-2xl font-bold">
                    <i class="fas fa-project-diagram mr-3"></i>
                    Network Topology - Home Network Map
                </h2>
                <button class="modal-close ripple" onclick="closeNetworkTopology()">
                    <i class="fas fa-times mr-2"></i>Close
                </button>
            </div>
            <div class="modal-body" style="height: calc(90vh - 100px); padding: 0;">
                <div class="flex h-full">
                    <!-- Sidebar Controls -->
                    <div class="w-64 p-4 border-r border-gray-700/50 overflow-y-auto">
                        <h3 class="text-lg font-bold mb-4 text-cyan-400">
                            <i class="fas fa-filter mr-2"></i>View Options
                        </h3>

                        <div class="space-y-3 mb-6">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="show-containers" checked onchange="updateNetworkView()" class="w-4 h-4 rounded">
                                <span class="text-sm">Docker Containers</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="show-networks" checked onchange="updateNetworkView()" class="w-4 h-4 rounded">
                                <span class="text-sm">Docker Networks</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="show-devices" checked onchange="updateNetworkView()" class="w-4 h-4 rounded">
                                <span class="text-sm">Network Devices</span>
                            </label>
                        </div>

                        <button onclick="scanNetwork()" class="w-full px-4 py-2 rounded-lg bg-cyan-500/20 text-cyan-300 border border-cyan-500/40 hover:bg-cyan-500/30 transition-all ripple text-sm font-semibold mb-4">
                            <i class="fas fa-search mr-2"></i>Scan Network
                        </button>

                        <div id="network-stats" class="space-y-2 text-xs">
                            <div class="flex justify-between p-2 bg-gray-800/40 rounded">
                                <span>Containers:</span>
                                <span id="topo-containers">0</span>
                            </div>
                            <div class="flex justify-between p-2 bg-gray-800/40 rounded">
                                <span>Networks:</span>
                                <span id="topo-networks">0</span>
                            </div>
                            <div class="flex justify-between p-2 bg-gray-800/40 rounded">
                                <span>Devices:</span>
                                <span id="topo-devices">0</span>
                            </div>
                        </div>

                        <div class="mt-6">
                            <h4 class="text-sm font-bold mb-2 text-gray-400">Legend</h4>
                            <div class="space-y-2 text-xs">
                                <div class="flex items-center gap-2">
                                    <div class="w-4 h-4 rounded-full bg-green-500"></div>
                                    <span>Container (Running)</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-4 h-4 rounded-full bg-red-500"></div>
                                    <span>Container (Stopped)</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-4 h-4 rounded-full bg-cyan-500"></div>
                                    <span>Network</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-4 h-4 rounded-full bg-purple-500"></div>
                                    <span>Network Device</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Network Graph -->
                    <div class="flex-1 relative">
                        <div id="network-graph" style="width: 100%; height: 100%; background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 41, 59, 0.95) 100%);"></div>
                        <div id="network-loading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none;">
                            <div class="spinner" style="margin: 0 auto;"></div>
                            <p class="mt-4 text-gray-400">Scanning network...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
