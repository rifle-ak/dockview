<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DockView - Container Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #151a35;
            --bg-card: #1a1f3a;
            --bg-card-hover: #1f2542;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
        }

        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, #0f1328 100%);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            min-height: 100vh;
        }

        /* Glassmorphism effect */
        .glass {
            background: rgba(26, 31, 58, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Card animations */
        .container-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, var(--bg-card) 0%, #1d2342 100%);
            border: 1px solid rgba(99, 102, 241, 0.1);
            position: relative;
        }

        .container-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.2), 0 0 40px rgba(139, 92, 246, 0.1);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .container-card.clickable {
            cursor: pointer;
        }

        .container-card.clickable:hover::after {
            content: 'üîó Click to open';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Uptime badge */
        .uptime-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.125rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .uptime-online {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
        }

        .uptime-offline {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
        }

        /* Status badges */
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-running {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }

        .status-exited, .status-stopped {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        .status-paused {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
        }

        /* Progress bars */
        .progress-container {
            height: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 9999px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            border-radius: 9999px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-low { background: linear-gradient(90deg, var(--success), #059669); }
        .progress-medium { background: linear-gradient(90deg, var(--warning), #d97706); }
        .progress-high { background: linear-gradient(90deg, var(--danger), #dc2626); }

        /* Buttons */
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
        }

        /* App icons */
        .app-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            padding: 8px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(99, 102, 241, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        /* Search bar */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 600px;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            background: rgba(26, 31, 58, 0.6);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 1rem;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* Tab buttons */
        .tab-button {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }

        .tab-button::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .tab-button.active {
            color: var(--text-primary);
        }

        .tab-button.active::after {
            transform: scaleX(1);
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid rgba(99, 102, 241, 0.1);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            background: var(--bg-card);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 0.75rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideIn 0.3s ease-out;
            z-index: 1000;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Pulse animation for running status */
        .pulse-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            50% {
                opacity: 0.8;
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
        }

        /* Stats counter */
        .stat-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }

        /* Widget Cards */
        .widget-card {
            background: linear-gradient(135deg, var(--bg-card) 0%, #1d2342 100%);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .widget-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 30px rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .widget-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .widget-header i {
            font-size: 1.5rem;
        }

        .widget-header h3 {
            font-weight: 600;
            font-size: 1.125rem;
            color: var(--text-primary);
        }

        .widget-content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .widget-stat {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .widget-value {
            font-size: 1.875rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .widget-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="glass sticky top-0 z-50 shadow-xl">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <div class="app-icon">
                        <i class="fab fa-docker" style="color: #2496ED;"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                            DockView
                        </h1>
                        <p class="text-xs text-gray-400">Container Management Dashboard</p>
                    </div>
                </div>

                <div class="flex items-center gap-4">
                    <div class="text-right hidden md:block">
                        <div class="text-sm text-gray-400">Auto-refresh</div>
                        <div class="text-sm font-semibold text-indigo-400">Every 10s</div>
                    </div>
                    <div id="stats-summary" class="flex gap-4">
                        <!-- Stats will be injected here -->
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <!-- Hero Section - Speedtest Display -->
        <div id="hero-speedtest" class="mb-12" style="display: none; animation: slideInDown 0.5s ease-out;">
            <div class="relative overflow-hidden rounded-3xl p-8 glass border-2 border-indigo-500/30 shadow-2xl">
                <div class="absolute top-0 right-0 w-96 h-96 bg-gradient-to-br from-indigo-500/20 to-purple-500/20 rounded-full blur-3xl -z-10"></div>
                <div class="absolute bottom-0 left-0 w-96 h-96 bg-gradient-to-tr from-blue-500/20 to-cyan-500/20 rounded-full blur-3xl -z-10"></div>

                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold mb-2 bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                        <i class="fas fa-tachometer-alt"></i> Network Performance
                    </h2>
                    <p class="text-gray-400 text-sm">Real-time internet speed metrics</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <!-- Download Speed -->
                    <div class="text-center p-6 rounded-2xl bg-gradient-to-br from-green-500/10 to-emerald-500/10 border border-green-500/20">
                        <div class="text-sm text-gray-400 mb-2 uppercase tracking-wider">
                            <i class="fas fa-download"></i> Download
                        </div>
                        <div class="text-5xl font-bold mb-1 bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent" id="hero-download">
                            --
                        </div>
                        <div class="text-xl text-gray-500">Mbps</div>
                    </div>

                    <!-- Upload Speed -->
                    <div class="text-center p-6 rounded-2xl bg-gradient-to-br from-blue-500/10 to-cyan-500/10 border border-blue-500/20">
                        <div class="text-sm text-gray-400 mb-2 uppercase tracking-wider">
                            <i class="fas fa-upload"></i> Upload
                        </div>
                        <div class="text-5xl font-bold mb-1 bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent" id="hero-upload">
                            --
                        </div>
                        <div class="text-xl text-gray-500">Mbps</div>
                    </div>

                    <!-- Ping -->
                    <div class="text-center p-6 rounded-2xl bg-gradient-to-br from-purple-500/10 to-pink-500/10 border border-purple-500/20">
                        <div class="text-sm text-gray-400 mb-2 uppercase tracking-wider">
                            <i class="fas fa-signal"></i> Latency
                        </div>
                        <div class="text-5xl font-bold mb-1 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent" id="hero-ping">
                            --
                        </div>
                        <div class="text-xl text-gray-500">ms</div>
                    </div>
                </div>

                <div class="text-center">
                    <div class="text-xs text-gray-500" id="hero-speedtest-server">Server: --</div>
                    <div class="text-xs text-gray-600 mt-1" id="hero-speedtest-time">Last tested: --</div>
                </div>
            </div>
        </div>

        <!-- Widgets Section -->
        <div id="widgets-section" class="mb-12" style="display: none;">
            <h2 class="text-2xl font-bold mb-6 bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                <i class="fas fa-chart-line"></i> Service Dashboard
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Tautulli / Plex Widget -->
                <div id="widget-tautulli" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fab fa-plex" style="color: #e5a00d;"></i>
                        <h3>Plex Activity</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="tautulli-streams">0</span>
                            <span class="widget-label">Active Streams</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="tautulli-bandwidth">0 Mbps</span>
                            <span class="widget-label">Bandwidth</span>
                        </div>
                    </div>
                </div>

                <!-- Pi-hole Widget -->
                <div id="widget-pihole" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-shield-alt" style="color: #96060c;"></i>
                        <h3>Pi-hole</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="pihole-blocked">0</span>
                            <span class="widget-label">Blocked Today</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="pihole-percent">0%</span>
                            <span class="widget-label">Block Rate</span>
                        </div>
                    </div>
                </div>

                <!-- Overseerr Widget -->
                <div id="widget-overseerr" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-ticket-alt" style="color: #a55eea;"></i>
                        <h3>Requests</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="overseerr-pending">0</span>
                            <span class="widget-label">Pending</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="overseerr-total">0</span>
                            <span class="widget-label">Total Requests</span>
                        </div>
                    </div>
                </div>

                <!-- Sonarr Widget -->
                <div id="widget-sonarr" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-tv" style="color: #4ECDC4;"></i>
                        <h3>Sonarr</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="sonarr-queue">0</span>
                            <span class="widget-label">In Queue</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="sonarr-upcoming">0</span>
                            <span class="widget-label">Airing Today</span>
                        </div>
                    </div>
                </div>

                <!-- Radarr Widget -->
                <div id="widget-radarr" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-film" style="color: #ffc230;"></i>
                        <h3>Radarr</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="radarr-queue">0</span>
                            <span class="widget-label">In Queue</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="radarr-upcoming">0</span>
                            <span class="widget-label">Releasing Today</span>
                        </div>
                    </div>
                </div>

                <!-- Tdarr Widget -->
                <div id="widget-tdarr" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-compact-disc" style="color: #f97316;"></i>
                        <h3>Tdarr</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="tdarr-queue">0</span>
                            <span class="widget-label">In Queue</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="tdarr-processing">0</span>
                            <span class="widget-label">Processing</span>
                        </div>
                    </div>
                </div>

                <!-- Prowlarr Widget -->
                <div id="widget-prowlarr" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-search" style="color: #f59e0b;"></i>
                        <h3>Prowlarr</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="prowlarr-enabled">0</span>
                            <span class="widget-label">Enabled</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="prowlarr-total">0</span>
                            <span class="widget-label">Total Indexers</span>
                        </div>
                    </div>
                </div>

                <!-- Scrutiny Widget -->
                <div id="widget-scrutiny" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-hdd" style="color: #10b981;"></i>
                        <h3>Disk Health</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="scrutiny-devices">0</span>
                            <span class="widget-label">Total Devices</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="scrutiny-critical">0</span>
                            <span class="widget-label">Critical</span>
                        </div>
                    </div>
                </div>

                <!-- Speedtest Widget -->
                <div id="widget-speedtest" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-tachometer-alt" style="color: #3b82f6;"></i>
                        <h3>Speed Test</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="speedtest-download">0</span>
                            <span class="widget-label">Download (Mbps)</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="speedtest-upload">0</span>
                            <span class="widget-label">Upload (Mbps)</span>
                        </div>
                    </div>
                </div>

                <!-- Uptime Kuma Widget -->
                <div id="widget-uptime" class="widget-card" style="display: none;">
                    <div class="widget-header">
                        <i class="fas fa-heartbeat" style="color: #10b981;"></i>
                        <h3>Service Uptime</h3>
                    </div>
                    <div class="widget-content">
                        <div class="widget-stat">
                            <span class="widget-value" id="uptime-online">0</span>
                            <span class="widget-label">Services Online</span>
                        </div>
                        <div class="widget-stat">
                            <span class="widget-value" id="uptime-total">0</span>
                            <span class="widget-label">Total Monitored</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search and Filters -->
        <div class="mb-8">
            <div class="search-container mx-auto mb-6">
                <i class="fas fa-search search-icon"></i>
                <input
                    type="text"
                    id="search-input"
                    class="search-input"
                    placeholder="Search containers by name, image, or status..."
                >
            </div>

            <!-- Tabs -->
            <div class="flex justify-center border-b border-gray-700/50">
                <button class="tab-button active" data-tab="all">
                    <i class="fas fa-th-large"></i> All Containers
                </button>
                <button class="tab-button" data-tab="running">
                    <i class="fas fa-play-circle"></i> Running
                </button>
                <button class="tab-button" data-tab="exited">
                    <i class="fas fa-stop-circle"></i> Stopped
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading" class="flex justify-center items-center py-20">
            <div class="spinner"></div>
            <div class="ml-4 text-gray-400">Loading containers...</div>
        </div>

        <!-- Container Grid -->
        <div id="container-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" style="display: none;">
            <!-- Cards will be injected here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="text-center py-20" style="display: none;">
            <div class="text-6xl mb-4">üê≥</div>
            <h2 class="text-2xl font-bold mb-2">No containers found</h2>
            <p class="text-gray-400">No containers match your search criteria</p>
        </div>
    </main>

    <script>
        // Service URL mappings for clickable cards
        const SERVICE_URLS = {
            plex: 'https://app.plex.tv',
            tautulli: '/tautulli',
            overseerr: '/overseerr',
            sonarr: '/sonarr',
            radarr: '/radarr',
            prowlarr: '/prowlarr',
            lidarr: '/lidarr',
            tdarr: '/tdarr',
            jellyfin: '/jellyfin',
            portainer: '/portainer',
            grafana: '/grafana',
            pihole: '/admin',
            nextcloud: '/nextcloud',
            photoprism: '/photoprism',
            immich: '/immich',
            homepage: '/',
            heimdall: '/',
            scrutiny: '/scrutiny',
            uptime: '/uptime',
            'uptime-kuma': '/uptime',
            speedtest: '/speedtest',
            'speedtest-tracker': '/speedtest',
        };

        // Icon mappings
        const APP_ICONS = {
            plex: { icon: 'fab fa-plex', color: '#e5a00d' },
            jellyfin: { icon: 'fas fa-film', color: '#00a4dc' },
            emby: { icon: 'fas fa-video', color: '#52b54b' },
            sonarr: { icon: 'fas fa-tv', color: '#4ECDC4' },
            radarr: { icon: 'fas fa-film', color: '#ffc230' },
            lidarr: { icon: 'fas fa-music', color: '#159588' },
            prowlarr: { icon: 'fas fa-search', color: '#f59e0b' },
            overseerr: { icon: 'fas fa-ticket-alt', color: '#a55eea' },
            tdarr: { icon: 'fas fa-compact-disc', color: '#f97316' },
            traefik: { icon: 'fas fa-route', color: '#24a1c1' },
            portainer: { icon: 'fas fa-dharmachakra', color: '#13bef9' },
            nginx: { icon: 'fas fa-server', color: '#009639' },
            postgresql: { icon: 'fas fa-database', color: '#336791' },
            postgres: { icon: 'fas fa-database', color: '#336791' },
            mysql: { icon: 'fas fa-database', color: '#4479a1' },
            mariadb: { icon: 'fas fa-database', color: '#c0765a' },
            redis: { icon: 'fas fa-database', color: '#dc382d' },
            mongodb: { icon: 'fas fa-leaf', color: '#47a248' },
            transmission: { icon: 'fas fa-download', color: '#e74c3c' },
            qbittorrent: { icon: 'fas fa-download', color: '#3498db' },
            sabnzbd: { icon: 'fas fa-download', color: '#ffc107' },
            nzbget: { icon: 'fas fa-download', color: '#9b59b6' },
            jackett: { icon: 'fas fa-search', color: '#34495e' },
            homepage: { icon: 'fas fa-home', color: '#6366f1' },
            heimdall: { icon: 'fas fa-home', color: '#e67e22' },
            organizr: { icon: 'fas fa-th', color: '#1abc9c' },
            grafana: { icon: 'fas fa-chart-line', color: '#f46800' },
            prometheus: { icon: 'fas fa-fire', color: '#e6522c' },
            netdata: { icon: 'fas fa-chart-area', color: '#00ab44' },
            pihole: { icon: 'fas fa-shield-alt', color: '#96060c' },
            adguard: { icon: 'fas fa-shield-alt', color: '#66b574' },
            nextcloud: { icon: 'fas fa-cloud', color: '#0082c9' },
            photoprism: { icon: 'fas fa-camera', color: '#00a0df' },
            immich: { icon: 'fas fa-images', color: '#4250af' },
            vaultwarden: { icon: 'fas fa-lock', color: '#175ddc' },
            wireguard: { icon: 'fas fa-network-wired', color: '#88171a' },
            openvpn: { icon: 'fas fa-shield-alt', color: '#ea7e20' },
            docker: { icon: 'fab fa-docker', color: '#2496ED' }
        };

        let allContainers = [];
        let currentFilter = 'all';
        let searchTerm = '';

        // DOM elements
        const containerGrid = document.getElementById('container-grid');
        const loading = document.getElementById('loading');
        const emptyState = document.getElementById('empty-state');
        const searchInput = document.getElementById('search-input');
        const tabButtons = document.querySelectorAll('.tab-button');
        const statsummary = document.getElementById('stats-summary');

        // Event listeners
        searchInput.addEventListener('input', (e) => {
            searchTerm = e.target.value.toLowerCase();
            filterAndRenderContainers();
        });

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                currentFilter = button.dataset.tab;
                filterAndRenderContainers();
            });
        });

        // Fetch containers
        async function fetchContainers() {
            try {
                const startTime = performance.now();
                console.log('üîÑ Fetching containers...');

                const response = await fetch('/containers');
                allContainers = await response.json();

                const elapsed = ((performance.now() - startTime) / 1000).toFixed(2);
                console.log(`‚úì Fetched ${allContainers.length} containers in ${elapsed}s`);

                updateStats();
                filterAndRenderContainers();
            } catch (error) {
                console.error('‚ùå Error fetching containers:', error);
                showToast('Failed to fetch containers', 'error');
            }
        }

        // Update stats summary
        function updateStats() {
            const running = allContainers.filter(c => c.status === 'running').length;
            const stopped = allContainers.filter(c => c.status !== 'running').length;

            statsummary.innerHTML = `
                <div class="stat-card">
                    <div class="text-xs text-gray-400 mb-1">Running</div>
                    <div class="stat-value">${running}</div>
                </div>
                <div class="stat-card">
                    <div class="text-xs text-gray-400 mb-1">Stopped</div>
                    <div class="stat-value">${stopped}</div>
                </div>
            `;
        }

        // Filter and render containers
        function filterAndRenderContainers() {
            let filtered = allContainers;

            // Apply status filter
            if (currentFilter !== 'all') {
                filtered = filtered.filter(c => c.status === currentFilter);
            }

            // Apply search filter
            if (searchTerm) {
                filtered = filtered.filter(c =>
                    c.name.toLowerCase().includes(searchTerm) ||
                    c.image.toLowerCase().includes(searchTerm) ||
                    c.status.toLowerCase().includes(searchTerm)
                );
            }

            renderContainers(filtered);
        }

        // Render containers
        function renderContainers(containers) {
            loading.style.display = 'none';

            if (containers.length === 0) {
                containerGrid.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            containerGrid.style.display = 'grid';
            emptyState.style.display = 'none';

            containerGrid.innerHTML = containers.map(container => {
                const appIcon = APP_ICONS[container.appType] || APP_ICONS.docker;
                const cpuClass = container.cpu > 75 ? 'progress-high' : container.cpu > 50 ? 'progress-medium' : 'progress-low';
                const memClass = container.memory > 75 ? 'progress-high' : container.memory > 50 ? 'progress-medium' : 'progress-low';
                const isRunning = container.status === 'running';
                const serviceUrl = SERVICE_URLS[container.appType] || SERVICE_URLS[container.name.toLowerCase()];
                const isClickable = serviceUrl && isRunning;

                return `
                    <div class="container-card rounded-2xl p-6 shadow-xl ${isClickable ? 'clickable' : ''}"
                         ${isClickable ? `onclick="window.open('${serviceUrl}', '_blank')"` : ''}>
                        <!-- Header -->
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center gap-3 flex-1 min-w-0">
                                <div class="app-icon" style="color: ${appIcon.color}">
                                    <i class="${appIcon.icon}"></i>
                                </div>
                                <div class="min-w-0 flex-1">
                                    <h3 class="font-bold text-lg truncate">${container.name}</h3>
                                    <p class="text-xs text-gray-400 truncate">${container.image}</p>
                                </div>
                            </div>
                            <span class="status-badge status-${container.status}">
                                ${isRunning ? '<span class="pulse-dot"></span>' : ''}
                                ${container.status}
                            </span>
                        </div>

                        <!-- Stats -->
                        <div class="space-y-3 mb-4">
                            <div>
                                <div class="flex justify-between text-xs text-gray-400 mb-1">
                                    <span><i class="fas fa-clock"></i> Uptime</span>
                                    <span class="font-semibold">${container.uptime}</span>
                                </div>
                            </div>

                            ${isRunning ? `
                                <div>
                                    <div class="flex justify-between text-xs text-gray-400 mb-1">
                                        <span><i class="fas fa-microchip"></i> CPU</span>
                                        <span class="font-semibold">${container.cpu.toFixed(2)}%</span>
                                    </div>
                                    <div class="progress-container">
                                        <div class="progress-bar ${cpuClass}" style="width: ${Math.min(container.cpu, 100)}%"></div>
                                    </div>
                                </div>

                                <div>
                                    <div class="flex justify-between text-xs text-gray-400 mb-1">
                                        <span><i class="fas fa-memory"></i> Memory</span>
                                        <span class="font-semibold">${container.memory.toFixed(2)}%</span>
                                    </div>
                                    <div class="progress-container">
                                        <div class="progress-bar ${memClass}" style="width: ${Math.min(container.memory, 100)}%"></div>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">${container.memory_text}</div>
                                </div>
                            ` : ''}
                        </div>

                        <!-- Ports -->
                        ${container.ports && container.ports.length > 0 ? `
                            <div class="mb-4">
                                <div class="text-xs text-gray-400 mb-2"><i class="fas fa-network-wired"></i> Ports</div>
                                <div class="flex flex-wrap gap-1">
                                    ${container.ports.map(port => `
                                        <span class="px-2 py-1 bg-indigo-500/20 text-indigo-300 rounded text-xs font-mono">${port}</span>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <!-- Actions -->
                        <div class="flex gap-2 mt-4 pt-4 border-t border-gray-700/50">
                            ${isRunning ? `
                                <button onclick="restartContainer('${container.id}')" class="btn btn-warning flex-1">
                                    <i class="fas fa-redo"></i> Restart
                                </button>
                                <button onclick="stopContainer('${container.id}')" class="btn btn-danger flex-1">
                                    <i class="fas fa-stop"></i> Stop
                                </button>
                            ` : `
                                <button onclick="startContainer('${container.id}')" class="btn btn-success flex-1">
                                    <i class="fas fa-play"></i> Start
                                </button>
                            `}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Container actions
        async function startContainer(id) {
            try {
                await fetch(`/start/${id}`, { method: 'POST' });
                showToast('Container started successfully', 'success');
                setTimeout(fetchContainers, 1000);
            } catch (error) {
                showToast('Failed to start container', 'error');
            }
        }

        async function stopContainer(id) {
            try {
                await fetch(`/stop/${id}`, { method: 'POST' });
                showToast('Container stopped successfully', 'success');
                setTimeout(fetchContainers, 1000);
            } catch (error) {
                showToast('Failed to stop container', 'error');
            }
        }

        async function restartContainer(id) {
            try {
                await fetch(`/restart/${id}`, { method: 'POST' });
                showToast('Container restarting...', 'info');
                setTimeout(fetchContainers, 2000);
            } catch (error) {
                showToast('Failed to restart container', 'error');
            }
        }

        // Toast notifications
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = 'toast';

            const icons = {
                success: '<i class="fas fa-check-circle" style="color: var(--success)"></i>',
                error: '<i class="fas fa-exclamation-circle" style="color: var(--danger)"></i>',
                info: '<i class="fas fa-info-circle" style="color: var(--info)"></i>'
            };

            toast.innerHTML = `
                ${icons[type] || icons.info}
                <span>${message}</span>
            `;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Widget functions (with error handling and fast timeout)
        async function fetchWidgets() {
            try {
                const startTime = performance.now();
                console.log('üìä Fetching widgets...');

                // Set a timeout for widget fetching to not block the UI
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 8000); // 8 second frontend timeout (match backend)

                const response = await fetch('/widgets/all', { signal: controller.signal });
                clearTimeout(timeoutId);
                const data = await response.json();

                const elapsed = ((performance.now() - startTime) / 1000).toFixed(2);
                console.log(`‚úì Fetched widgets in ${elapsed}s`);

                if (!data.enabled) {
                    console.log('‚Ñπ Widgets are disabled in config');
                    return;
                }

                const widgetsSection = document.getElementById('widgets-section');
                widgetsSection.style.display = 'block';

                const widgets = data.widgets;
                let visibleWidgets = 0;

                // Update Tautulli widget
                if (widgets.tautulli && widgets.tautulli.available) {
                    console.log('üì∫ Tautulli data:', widgets.tautulli);
                    document.getElementById('widget-tautulli').style.display = 'block';
                    document.getElementById('tautulli-streams').textContent = widgets.tautulli.stream_count || 0;
                    const bandwidth = widgets.tautulli.total_bandwidth ?
                        (widgets.tautulli.total_bandwidth / 1000).toFixed(1) + ' Mbps' : '0 Mbps';
                    document.getElementById('tautulli-bandwidth').textContent = bandwidth;
                    visibleWidgets++;
                }

                // Update Pi-hole widget
                if (widgets.pihole && widgets.pihole.available) {
                    console.log('üõ°Ô∏è Pi-hole data:', widgets.pihole);
                    document.getElementById('widget-pihole').style.display = 'block';
                    document.getElementById('pihole-blocked').textContent = (widgets.pihole.blocked_today || 0).toLocaleString();
                    document.getElementById('pihole-percent').textContent = (widgets.pihole.percent_blocked || 0) + '%';
                    visibleWidgets++;
                }

                // Update Overseerr widget
                if (widgets.overseerr && widgets.overseerr.available) {
                    console.log('üé´ Overseerr data:', widgets.overseerr);
                    document.getElementById('widget-overseerr').style.display = 'block';
                    document.getElementById('overseerr-pending').textContent = widgets.overseerr.pending_requests || 0;
                    document.getElementById('overseerr-total').textContent = widgets.overseerr.total_requests || 0;
                    visibleWidgets++;
                }

                // Update Sonarr widget
                if (widgets.sonarr && widgets.sonarr.available) {
                    console.log('üì∫ Sonarr data:', widgets.sonarr);
                    document.getElementById('widget-sonarr').style.display = 'block';
                    document.getElementById('sonarr-queue').textContent = widgets.sonarr.queue_count || 0;
                    document.getElementById('sonarr-upcoming').textContent = widgets.sonarr.upcoming_today || 0;
                    visibleWidgets++;
                }

                // Update Radarr widget
                if (widgets.radarr && widgets.radarr.available) {
                    console.log('üé¨ Radarr data:', widgets.radarr);
                    document.getElementById('widget-radarr').style.display = 'block';
                    document.getElementById('radarr-queue').textContent = widgets.radarr.queue_count || 0;
                    document.getElementById('radarr-upcoming').textContent = widgets.radarr.upcoming_today || 0;
                    visibleWidgets++;
                }

                // Update Tdarr widget
                if (widgets.tdarr && widgets.tdarr.available) {
                    console.log('üíø Tdarr data:', widgets.tdarr);
                    document.getElementById('widget-tdarr').style.display = 'block';
                    document.getElementById('tdarr-queue').textContent = widgets.tdarr.queue_count || 0;
                    document.getElementById('tdarr-processing').textContent = widgets.tdarr.processing || 0;
                    visibleWidgets++;
                }

                // Update Prowlarr widget
                if (widgets.prowlarr && widgets.prowlarr.available) {
                    console.log('üîç Prowlarr data:', widgets.prowlarr);
                    document.getElementById('widget-prowlarr').style.display = 'block';
                    document.getElementById('prowlarr-enabled').textContent = widgets.prowlarr.enabled_indexers || 0;
                    document.getElementById('prowlarr-total').textContent = widgets.prowlarr.total_indexers || 0;
                    visibleWidgets++;
                }

                // Update Scrutiny widget
                if (widgets.scrutiny && widgets.scrutiny.available) {
                    console.log('üíΩ Scrutiny data:', widgets.scrutiny);
                    document.getElementById('widget-scrutiny').style.display = 'block';
                    document.getElementById('scrutiny-devices').textContent = widgets.scrutiny.total_devices || 0;
                    const critical = widgets.scrutiny.critical || 0;
                    const criticalElement = document.getElementById('scrutiny-critical');
                    criticalElement.textContent = critical;
                    // Change color if critical
                    if (critical > 0) {
                        criticalElement.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                        criticalElement.style.webkitBackgroundClip = 'text';
                        criticalElement.style.webkitTextFillColor = 'transparent';
                    }
                    visibleWidgets++;
                }

                // Update Speedtest widget and hero section
                if (widgets.speedtest && widgets.speedtest.available) {
                    console.log('üéØ Showing speedtest hero section with data:', widgets.speedtest);

                    // Show and update hero section
                    const heroSection = document.getElementById('hero-speedtest');
                    heroSection.style.display = 'block';

                    // Update hero numbers with animation
                    const downloadEl = document.getElementById('hero-download');
                    const uploadEl = document.getElementById('hero-upload');
                    const pingEl = document.getElementById('hero-ping');

                    downloadEl.textContent = widgets.speedtest.download.toFixed(0);
                    uploadEl.textContent = widgets.speedtest.upload.toFixed(0);
                    pingEl.textContent = widgets.speedtest.ping.toFixed(1);

                    document.getElementById('hero-speedtest-server').textContent = `Server: ${widgets.speedtest.server || 'Unknown'}`;

                    if (widgets.speedtest.timestamp) {
                        const date = new Date(widgets.speedtest.timestamp);
                        const timeStr = date.toLocaleString();
                        document.getElementById('hero-speedtest-time').textContent = `Last tested: ${timeStr}`;
                    }

                    // Update speedtest widget
                    document.getElementById('widget-speedtest').style.display = 'block';
                    document.getElementById('speedtest-download').textContent = widgets.speedtest.download.toFixed(1);
                    document.getElementById('speedtest-upload').textContent = widgets.speedtest.upload.toFixed(1);
                    visibleWidgets++;

                    console.log(`‚úÖ Hero section now visible! Download: ${widgets.speedtest.download} Mbps, Upload: ${widgets.speedtest.upload} Mbps`);

                    // Scroll to hero section smoothly to make it visible
                    setTimeout(() => {
                        heroSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 100);
                }

                // Update Uptime Kuma widget
                if (widgets.uptime_kuma && widgets.uptime_kuma.available) {
                    document.getElementById('widget-uptime').style.display = 'block';
                    document.getElementById('uptime-online').textContent = widgets.uptime_kuma.up_count || 0;
                    document.getElementById('uptime-total').textContent = widgets.uptime_kuma.total_count || 0;
                    visibleWidgets++;
                }

                console.log(`‚úì Displayed ${visibleWidgets} widgets`);
                console.log('üìä Full widget response:', data.widgets);

                // Show toast notification when widgets load
                if (visibleWidgets > 0) {
                    showToast(`Loaded ${visibleWidgets} widget${visibleWidgets > 1 ? 's' : ''}`, 'success');
                } else {
                    console.warn('‚ö†Ô∏è No widgets displayed - check API keys in config.yaml');
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.warn('‚è± Widget fetch timed out after 8 seconds');
                } else {
                    console.error('‚ùå Error fetching widgets:', error);
                }
                // Don't block the UI - just log and continue
            }
        }

        // Auto-refresh
        setInterval(fetchContainers, 10000);
        setInterval(fetchWidgets, 30000); // Refresh widgets every 30 seconds

        // Initial fetch - containers first for instant display, widgets after
        fetchContainers();
        // Delay widget fetch slightly to prioritize container display
        setTimeout(fetchWidgets, 500);
    </script>
</body>
</html>
